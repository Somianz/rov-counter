<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROV Hero Counter Guide - Complete</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- ‡πÇ‡∏´‡∏•‡∏î CSS ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° Lazy Loading -->
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg0:#04080f;--bg1:#080e1a;--bg2:#0d1424;--bg3:#131d32;--bg4:#1a2540;
  --txt:#dce4f5;--txt2:#7a8db0;--txt3:#3d5070;
  --gold:#f0b429;--gold2:#d4930a;
  --blue:#4f6ef7;--blue2:#3a54e0;--blue-glow:rgba(79,110,247,.35);
  --green:#00e87a;--green2:#00b85e;--green-glow:rgba(0,232,122,.3);
  --red:#f04060;--red2:#c0283c;--red-glow:rgba(240,64,96,.3);
  --purple:#9b5de5;--cyan:#00d4ff;
  --bdr:rgba(255,255,255,0.07);--bdr2:rgba(255,255,255,0.12);
  --r8:8px;--r12:12px;--r16:16px;--r24:24px;
  --shadow-sm:0 2px 8px rgba(0,0,0,.4);
  --shadow-md:0 4px 20px rgba(0,0,0,.5);
  --shadow-lg:0 8px 40px rgba(0,0,0,.65);
}
body{font-family:'Kanit',sans-serif;background:var(--bg0);color:var(--txt);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(ellipse 80% 60% at 10% 20%,rgba(79,110,247,.12) 0%,transparent 60%),radial-gradient(ellipse 60% 80% at 90% 80%,rgba(0,232,122,.08) 0%,transparent 60%),radial-gradient(ellipse 50% 40% at 50% 50%,rgba(155,93,229,.05) 0%,transparent 70%);animation:meshMove 12s ease-in-out infinite alternate}
@keyframes meshMove{from{background-position:0% 0%,100% 100%,50% 50%}to{background-position:5% 8%,95% 92%,52% 48%}}
body::after{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px);opacity:.5}
img{display:block;width:100%;height:100%;object-fit:cover}
img.lazy-img{opacity:0;transition:opacity .3s}
img.lazy-img.loaded{opacity:1}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg1)}
::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px}
button:active,.hero-card:active,.picker-item:active,.lib-item:active,.role-btn:active{transform:scale(.94)!important;filter:brightness(.85);transition:transform .08s,filter .08s!important}
#fab:active{transform:scale(.9) rotate(45deg)!important}
#lockBtn:active{transform:scale(.88)!important}

.wrap{max-width:1440px;margin:0 auto;padding:24px 20px;position:relative;z-index:1}
.hdr{text-align:center;padding:36px 20px 20px;margin-bottom:28px}
.hdr-eyebrow{font-family:'Rajdhani',sans-serif;letter-spacing:.25em;font-size:.72rem;color:var(--gold);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:12px}
.hdr-eyebrow::before,.hdr-eyebrow::after{content:'';flex:1;max-width:80px;height:1px;background:linear-gradient(90deg,transparent,var(--gold))}
.hdr-eyebrow::after{background:linear-gradient(90deg,var(--gold),transparent)}
.hdr h1{font-family:'Rajdhani',sans-serif;font-size:clamp(2rem,5vw,3.2rem);font-weight:700;letter-spacing:.04em;background:linear-gradient(135deg,#fff 0%,var(--gold) 40%,var(--blue) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.1;margin-bottom:10px}
.hdr-sub{color:var(--txt2);font-size:.9rem}

#lockBtn{position:fixed;top:20px;right:20px;width:44px;height:44px;background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1.5px solid var(--bdr2);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;font-size:1.2rem;box-shadow:var(--shadow-md);transition:all .2s}
#lockBtn:hover{border-color:var(--blue);box-shadow:0 0 20px var(--blue-glow);transform:scale(1.08)}
#lockBtn.open{border-color:var(--green);box-shadow:0 0 20px var(--green-glow)}

.roles{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:28px}
.role-btn{padding:9px 18px;background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1.5px solid var(--bdr);border-radius:var(--r8);color:var(--txt);font-family:'Rajdhani',sans-serif;font-size:.9rem;font-weight:600;letter-spacing:.05em;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.role-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--blue),var(--purple));opacity:0;transition:opacity .2s}
.role-btn:hover{border-color:var(--blue);color:#fff;transform:translateY(-2px);box-shadow:0 4px 16px var(--blue-glow)}
.role-btn:hover::before{opacity:.15}
.role-btn.on{background:linear-gradient(135deg,var(--blue),var(--blue2));border-color:var(--blue);color:#fff;box-shadow:0 0 20px var(--blue-glow),0 4px 12px rgba(0,0,0,.3);transform:translateY(-2px)}
.role-btn span{position:relative;z-index:1}

.hero-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:32px}
.hero-card{aspect-ratio:3/4;background:var(--bg2);border-radius:var(--r12);overflow:hidden;cursor:pointer;position:relative;border:1.5px solid var(--bdr);transition:transform .25s cubic-bezier(.34,1.56,.64,1),box-shadow .25s,border-color .25s;box-shadow:var(--shadow-sm);animation:fadeUp .5s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.hero-card::before{content:'';position:absolute;inset:0;z-index:1;background:linear-gradient(to top,rgba(0,0,0,.92) 0%,rgba(0,0,0,.3) 45%,transparent 100%);pointer-events:none}
.hero-card:hover{transform:translateY(-8px) scale(1.03);box-shadow:0 12px 36px rgba(0,0,0,.5),0 0 0 1.5px var(--gold);border-color:var(--gold);z-index:5}
.hero-card-img{width:100%;height:100%;position:absolute;inset:0}
.hero-card-img img{width:100%;height:100%;object-fit:cover;object-position:center top}
.hero-card-placeholder{width:100%;height:100%;position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:3.5rem;background:var(--bg3)}
.hero-card-name{position:absolute;bottom:0;left:0;right:0;z-index:2;padding:20px 10px 10px;text-align:center;font-family:'Rajdhani',sans-serif;font-size:.9rem;font-weight:700;letter-spacing:.04em;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.95)}
.hero-card-badge{position:absolute;top:8px;right:8px;z-index:2;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#000;font-size:.65rem;font-weight:700;padding:3px 8px;border-radius:10px;letter-spacing:.05em;font-family:'Rajdhani',sans-serif;box-shadow:0 2px 8px rgba(0,0,0,.4)}
.hero-card-role{position:absolute;top:8px;left:8px;z-index:2;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);font-size:.62rem;font-weight:600;padding:3px 8px;border-radius:5px;border:1px solid var(--bdr2);color:var(--gold);font-family:'Rajdhani',sans-serif;letter-spacing:.05em}
.no-hero{text-align:center;padding:80px 20px;color:var(--txt3);animation:fadeUp .5s ease}
.no-hero .ico{font-size:5rem;opacity:.25;margin-bottom:18px;display:block}
.no-hero p{font-size:.95rem;line-height:1.8}

/* Modal Base */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.88);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;padding:16px;z-index:2100}
.modal-bg.show{display:flex}
.modal-bg.show ~ #lockBtn,.modal-bg.show ~ #fab{pointer-events:none;opacity:0.2}
.modal-box{background:linear-gradient(160deg,var(--bg2) 0%,var(--bg1) 100%);border-radius:var(--r16);border:1px solid var(--bdr2);box-shadow:var(--shadow-lg);width:100%;max-width:820px;max-height:90vh;display:flex;flex-direction:column;animation:modalIn .3s cubic-bezier(.34,1.36,.64,1) both}
@keyframes modalIn{from{opacity:0;transform:scale(.9) translateY(24px)}to{opacity:1;transform:none}}
.modal-hdr{padding:20px 24px;background:linear-gradient(135deg,var(--bg3) 0%,var(--bg2) 100%);border-bottom:1px solid var(--bdr);border-radius:var(--r16) var(--r16) 0 0;display:flex;align-items:center;gap:12px}
.modal-hdr h2{font-size:1.2rem;font-weight:700;flex:1;font-family:'Rajdhani',sans-serif;letter-spacing:.04em}
.modal-close{width:34px;height:34px;flex-shrink:0;background:rgba(255,255,255,.06);border:1px solid var(--bdr);border-radius:50%;color:var(--txt2);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;line-height:1}
.modal-close:hover{background:var(--red);border-color:var(--red);color:#fff;transform:rotate(90deg)!important;filter:none!important}
.modal-body{padding:22px 24px;overflow-y:auto;flex:1;scroll-behavior:smooth}
.modal-body::-webkit-scrollbar{width:6px}
.modal-body::-webkit-scrollbar-track{background:var(--bg2)}
.modal-body::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px}
.modal-ftr{padding:14px 24px;background:rgba(0,0,0,.2);border-top:1px solid var(--bdr);border-radius:0 0 var(--r16) var(--r16);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-shrink:0}

/* Detail Modal */
.detail-hero-row{display:flex;gap:22px;align-items:flex-start}
.detail-img{width:120px;height:150px;flex-shrink:0;border-radius:var(--r12);overflow:hidden;border:2px solid var(--blue);box-shadow:0 0 28px var(--blue-glow),var(--shadow-md);position:relative}
.detail-img img{width:100%;height:100%;object-fit:cover;object-position:center top}
.detail-info{flex:1;min-width:0}
.detail-info h2{font-family:'Rajdhani',sans-serif;font-size:2rem;font-weight:700;letter-spacing:.04em;line-height:1;margin-bottom:10px;background:linear-gradient(135deg,#fff 0%,var(--gold) 60%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.detail-tags{display:flex;gap:7px;flex-wrap:wrap}
.tag{padding:5px 12px;background:linear-gradient(135deg,var(--bg3),var(--bg4));border-radius:20px;font-size:.78rem;color:var(--txt2);border:1px solid var(--bdr2);font-family:'Rajdhani',sans-serif;font-weight:600;letter-spacing:.05em}
.detail-section{margin-top:20px}
.detail-section h3{font-family:'Rajdhani',sans-serif;font-size:1rem;font-weight:700;color:var(--gold);margin-bottom:12px;letter-spacing:.08em;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.detail-section h3::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--gold),transparent);opacity:.4}
.c-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px}
.c-card{background:var(--bg3);border-radius:var(--r12);overflow:hidden;border:1px solid var(--bdr);transition:transform .2s,border-color .2s}
.c-card:hover{transform:scale(1.06);border-color:var(--gold)}
.c-card-img{aspect-ratio:1;background:var(--bg2);overflow:hidden;position:relative}
.c-card-img img{width:100%;height:100%;object-fit:cover;object-position:center}
.c-card-name{padding:6px 4px;text-align:center;font-size:.72rem;font-weight:600;color:var(--txt);font-family:'Rajdhani',sans-serif;letter-spacing:.03em}
.notes-box{background:var(--bg3);border-radius:var(--r12);padding:16px;border:1px solid var(--bdr);color:var(--txt2);line-height:1.8;white-space:pre-wrap;font-size:.88rem}

/* Form Elements */
.edit-thumb{width:42px;height:42px;border-radius:10px;overflow:hidden;border:2px solid var(--blue);flex-shrink:0;box-shadow:0 0 12px var(--blue-glow)}
.form-lbl{font-size:.82rem;font-weight:600;margin-bottom:8px;display:block;color:var(--gold);font-family:'Rajdhani',sans-serif;letter-spacing:.06em;text-transform:uppercase}
.form-grp{margin-bottom:20px}
.form-ta{width:100%;min-height:100px;padding:12px;background:var(--bg3);border:1.5px solid var(--bdr);border-radius:var(--r12);color:var(--txt);font-family:'Kanit',sans-serif;font-size:.9rem;resize:vertical;transition:border-color .2s}
.form-ta:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px rgba(79,110,247,.15)}
.form-ta::placeholder{color:var(--txt3)}

/* Picker */
.picker-wrap{background:var(--bg3);border:1.5px solid var(--bdr);border-radius:var(--r12);overflow:hidden}
.picker-search-inp{width:100%;padding:11px 14px;background:var(--bg2);border:none;border-bottom:1.5px solid var(--bdr);color:var(--txt);font-family:'Kanit',sans-serif;font-size:.88rem;transition:background .2s}
.picker-search-inp:focus{outline:none;background:var(--bg1);border-bottom-color:var(--blue)}
.picker-search-inp::placeholder{color:var(--txt3)}
.picker-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;padding:12px;max-height:260px;overflow-y:auto;scroll-behavior:smooth}
.picker-grid::-webkit-scrollbar{width:6px}
.picker-grid::-webkit-scrollbar-track{background:var(--bg2)}
.picker-grid::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px}
.picker-item{aspect-ratio:3/4;background:var(--bg2);border-radius:var(--r8);overflow:hidden;cursor:pointer;position:relative;border:2px solid transparent;transition:border-color .15s,box-shadow .15s,transform .15s;user-select:none;min-height:100px}
.picker-item:hover{border-color:rgba(79,110,247,.6)!important;transform:scale(1.06)!important;z-index:2}
.picker-item.picked{border-color:var(--green)!important;box-shadow:0 0 0 2px var(--green),0 0 16px var(--green-glow)!important}
.picker-item.picked .picker-item-img::after{content:'';position:absolute;inset:0;background:rgba(0,232,122,.18);pointer-events:none}
.picker-item.picked .picker-ck{display:flex}
.picker-ck{display:none;position:absolute;bottom:22px;right:3px;z-index:3;width:18px;height:18px;background:var(--green);border-radius:50%;align-items:center;justify-content:center;font-size:.65rem;color:#000;font-weight:900;box-shadow:0 2px 6px rgba(0,0,0,.4);pointer-events:none}
.picker-item-img{width:100%;height:calc(100% - 22px);position:relative;overflow:hidden;background:var(--bg3)}
.picker-item-img img{width:100%;height:100%;object-fit:cover;object-position:center}
.picker-item-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.6rem;background:var(--bg3);color:var(--txt3)}
.picker-item-name{font-size:.64rem;font-weight:700;text-align:center;padding:3px 2px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:'Rajdhani',sans-serif;letter-spacing:.03em;position:relative;z-index:1;background:rgba(0,0,0,.7)}
.picker-empty{padding:28px;text-align:center;color:var(--txt3);font-size:.85rem;grid-column:1/-1}

/* Picked Tags */
.picked-list{display:flex;flex-wrap:wrap;gap:7px;margin-top:10px;min-height:20px}
.picked-tag{padding:5px 11px;background:rgba(0,232,122,.08);border:1.5px solid var(--green);border-radius:20px;font-size:.78rem;color:var(--green);display:inline-flex;align-items:center;gap:6px;animation:tagIn .2s ease}
@keyframes tagIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.picked-tag img{width:20px;height:20px;border-radius:4px;flex-shrink:0;object-fit:cover}
.picked-tag-rm{cursor:pointer;color:rgba(0,232,122,.45);font-size:1.1rem;line-height:1;padding:0 2px;border:none;background:none;font-family:inherit;transition:color .15s}
.picked-tag-rm:hover{color:var(--red)!important;transform:none!important;filter:none!important}
.picked-empty{color:var(--txt3);font-size:.82rem;padding:2px 0}

/* Library Modal */
#libModal .modal-box{max-width:1080px}
.lib-tabs{display:flex;background:var(--bg2);border-bottom:2px solid var(--bdr);flex-shrink:0}
.lib-tab{padding:13px 22px;background:transparent;border:none;color:var(--txt);font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all .2s;font-size:.9rem;letter-spacing:.05em}
.lib-tab:hover{color:var(--blue)}
.lib-tab.on{color:var(--blue);border-bottom-color:var(--blue)}
.lib-body{flex:1;overflow-y:auto;padding:18px 22px;scroll-behavior:smooth}
.lib-body::-webkit-scrollbar{width:6px}
.lib-body::-webkit-scrollbar-track{background:var(--bg2)}
.lib-body::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px}
.lib-search{width:100%;padding:10px 14px;background:var(--bg3);border:1.5px solid var(--bdr);border-radius:var(--r8);color:var(--txt);font-family:'Kanit',sans-serif;font-size:.88rem;margin-bottom:14px;transition:border-color .2s}
.lib-search:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px rgba(79,110,247,.15)}
.lib-search::placeholder{color:var(--txt3)}
.lib-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px}
.lib-item{aspect-ratio:3/4;background:var(--bg3);border-radius:var(--r8);overflow:hidden;position:relative;border:2px solid var(--bdr);transition:border-color .15s,box-shadow .15s,transform .18s;cursor:pointer;min-height:110px}
.lib-item:hover{border-color:rgba(79,110,247,.5)!important;transform:scale(1.05)!important}
.lib-item.lib-selected{border-color:var(--green)!important;box-shadow:0 0 0 2px var(--green),0 0 18px var(--green-glow)!important}
.lib-item.lib-selected .lib-item-inner::after{content:'';position:absolute;inset:0;background:rgba(0,232,122,.15);pointer-events:none}
.lib-item.lib-selected .lib-ck{display:flex}
.lib-ck{display:none;position:absolute;bottom:23px;right:4px;z-index:3;width:18px;height:18px;background:var(--green);border-radius:50%;align-items:center;justify-content:center;font-size:.65rem;color:#000;font-weight:900;pointer-events:none;box-shadow:0 2px 6px rgba(0,0,0,.4)}
.lib-item-inner{width:100%;height:calc(100% - 24px);position:relative;overflow:hidden;background:var(--bg3)}
.lib-item-inner img{width:100%;height:100%;object-fit:cover;object-position:center}
.lib-item-ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:2rem;color:var(--txt3);background:var(--bg3)}
.lib-item-name{font-size:.7rem;font-weight:700;text-align:center;padding:4px 3px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:'Rajdhani',sans-serif;letter-spacing:.03em;position:relative;z-index:1;background:rgba(0,0,0,.75)}
.lib-item-del{position:absolute;top:4px;right:4px;z-index:4;width:22px;height:22px;background:var(--red);border:none;border-radius:50%;color:#fff;font-size:.85rem;cursor:pointer;display:none;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.5);line-height:1;padding:0}
.lib-item:hover .lib-item-del{display:flex}
.read-mode .lib-item-del{display:none!important}

/* Quick Add Form */
.qadd-form{background:linear-gradient(135deg,var(--bg3),var(--bg2));border-radius:var(--r12);padding:20px;border:1.5px dashed var(--bdr2)}
.qadd-title{font-family:'Rajdhani',sans-serif;font-size:1rem;font-weight:700;color:var(--blue);margin-bottom:14px;letter-spacing:.05em}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.f-inp,.f-sel{width:100%;padding:9px 12px;background:var(--bg2);border:1.5px solid var(--bdr);border-radius:var(--r8);color:var(--txt);font-family:'Kanit',sans-serif;font-size:.85rem;transition:border-color .2s}
.f-inp:focus,.f-sel:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 2px rgba(79,110,247,.15)}
.f-inp::placeholder{color:var(--txt3)}
.f-sel option{background:var(--bg2)}
.upload-zone{border:2px dashed var(--bdr2);border-radius:var(--r8);padding:18px;text-align:center;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;min-height:62px;margin-bottom:10px;color:var(--txt2);font-size:.85rem}
.upload-zone:hover{border-color:var(--blue);background:rgba(79,110,247,.06);color:var(--blue)}
.upload-zone.has-img{padding:4px}
.upload-preview{width:100%;max-height:130px;object-fit:contain;border-radius:var(--r8)}

/* Buttons */
.btn{padding:9px 20px;border-radius:var(--r8);font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;transition:all .2s;font-size:.9rem;display:inline-flex;align-items:center;gap:7px;border:none;letter-spacing:.05em;position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0);transition:background .15s}
.btn:hover::after{background:rgba(255,255,255,.08)}
.btn-ghost{background:rgba(255,255,255,.05);border:1.5px solid var(--bdr2);color:var(--txt)}
.btn-ghost:hover{border-color:var(--txt);color:#fff;background:rgba(255,255,255,.1)}
.btn-primary{background:linear-gradient(135deg,var(--blue),var(--blue2));color:#fff;box-shadow:0 3px 10px var(--blue-glow)}
.btn-primary:hover{box-shadow:0 5px 18px var(--blue-glow);transform:translateY(-1px)}
.btn-success{background:linear-gradient(135deg,var(--green),var(--green2));color:#000;box-shadow:0 3px 10px var(--green-glow);font-weight:800}
.btn-success:hover{box-shadow:0 5px 18px var(--green-glow);transform:translateY(-1px)}
.btn-danger{background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;box-shadow:0 3px 10px var(--red-glow)}
.btn-danger:hover{box-shadow:0 5px 18px var(--red-glow);transform:translateY(-1px)}
.btn-qadd{width:100%;padding:11px;background:linear-gradient(135deg,var(--blue),var(--blue2));color:#fff;border:none;border-radius:var(--r8);font-family:'Rajdhani',sans-serif;font-weight:700;cursor:pointer;transition:all .2s;font-size:.95rem;letter-spacing:.05em;box-shadow:0 4px 12px var(--blue-glow)}
.btn-qadd:hover{transform:translateY(-2px);box-shadow:0 6px 18px var(--blue-glow)}

/* FAB */
#fab{position:fixed;bottom:28px;right:28px;width:58px;height:58px;z-index:999;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:2rem;color:#fff;box-shadow:0 4px 20px rgba(79,110,247,.55),0 8px 32px rgba(0,0,0,.3);transition:all .3s cubic-bezier(.34,1.56,.64,1);border:2px solid rgba(255,255,255,.15);font-weight:300;line-height:1}
#fab:hover{transform:scale(1.12) rotate(90deg);box-shadow:0 6px 28px rgba(79,110,247,.7)}
.read-mode #fab{display:none}
.read-mode .admin-only{display:none!important}

/* Lock Overlay */
#lockOverlay,#cfmOverlay{position:fixed;inset:0;background:rgba(0,0,0,.9);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;padding:20px;z-index:2400}
#lockOverlay.show,#cfmOverlay.show{display:flex}
#lockOverlay.show ~ #lockBtn{display:none}
.lock-box,.cfm-box{background:linear-gradient(160deg,var(--bg3),var(--bg2));border-radius:var(--r16);padding:38px 32px;max-width:380px;width:100%;border:1px solid var(--bdr2);box-shadow:var(--shadow-lg);text-align:center;animation:modalIn .3s ease}
.lock-ico,.cfm-ico-wrap{font-size:3rem;margin-bottom:14px;display:block}
.lock-box h3,.cfm-box h3{font-family:'Rajdhani',sans-serif;font-size:1.4rem;font-weight:700;margin-bottom:8px;letter-spacing:.04em;color:var(--txt)}
.lock-box p{color:var(--txt2);font-size:.88rem;margin-bottom:18px;line-height:1.6}
.cfm-msg{color:var(--txt2);font-size:.9rem;margin-bottom:22px;line-height:1.6}
.pw-inp{width:100%;padding:13px;background:var(--bg3);border:1.5px solid var(--bdr2);border-radius:var(--r8);color:var(--txt);font-size:1rem;text-align:center;letter-spacing:4px;margin-bottom:16px;font-family:'Kanit',sans-serif;transition:border-color .2s}
.pw-inp:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px rgba(79,110,247,.2)}
.lock-btns,.cfm-btns{display:flex;gap:10px;justify-content:center}

/* Toast */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--bg3),var(--bg2));color:var(--txt);padding:12px 20px;border-radius:var(--r12);box-shadow:var(--shadow-lg);border:1px solid var(--bdr2);z-index:9999;display:flex;align-items:center;gap:10px;animation:toastIn .3s cubic-bezier(.34,1.5,.64,1);white-space:nowrap;font-size:.88rem;font-weight:500;pointer-events:none}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(16px) scale(.9)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}
.toast.ok{border-left:3px solid var(--green)}
.toast.err{border-left:3px solid var(--red)}
.toast.info{border-left:3px solid var(--blue)}

/* Loading */
.loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);display:none;z-index:9998;align-items:center;justify-content:center}
.loading-overlay.show{display:flex}
.loading-spinner{width:50px;height:50px;border:4px solid var(--bg3);border-top-color:var(--blue);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:var(--txt);font-size:1rem;margin-top:80px;text-align:center;font-weight:500;position:absolute}

@media(max-width:1100px){.hero-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.hero-grid{grid-template-columns:repeat(3,1fr)}.detail-hero-row{flex-direction:column}.picker-grid{grid-template-columns:repeat(auto-fill,minmax(70px,1fr))}.lib-grid{grid-template-columns:repeat(auto-fill,minmax(80px,1fr))}}
@media(max-width:540px){.hero-grid{grid-template-columns:repeat(2,1fr)}.hdr h1{font-size:1.8rem}.form-row{grid-template-columns:1fr}.modal-body{padding:16px}.modal-hdr{padding:16px 18px}.roles{gap:6px}.role-btn{padding:7px 14px;font-size:.85rem}.picker-grid{grid-template-columns:repeat(auto-fill,minmax(65px,1fr))}.c-grid{grid-template-columns:repeat(auto-fill,minmax(75px,1fr))}}
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div><div class="loading-spinner"></div><div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
</div>

<button id="lockBtn" onclick="toggleLock()">üîí</button>
<div id="fab" onclick="openAddHero()">+</div>

<div class="wrap">
  <div class="hdr">
    <div class="hdr-eyebrow"><span>Realm of Valor - Complete Edition</span></div>
    <h1>‚öî Hero Counter Guide</h1>
    <p class="hdr-sub">‚ö° ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡πá‡∏ß + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö</p>
  </div>

  <div class="roles">
    <button class="role-btn on" data-r="all" onclick="setRole('all')"><span>üéØ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span></button>
    <button class="role-btn" data-r="Tank" onclick="setRole('Tank')"><span>üõ°Ô∏è Tank</span></button>
    <button class="role-btn" data-r="Fighter" onclick="setRole('Fighter')"><span>‚öîÔ∏è Fighter</span></button>
    <button class="role-btn" data-r="Assassin" onclick="setRole('Assassin')"><span>üó°Ô∏è Assassin</span></button>
    <button class="role-btn" data-r="Mage" onclick="setRole('Mage')"><span>üîÆ Mage</span></button>
    <button class="role-btn" data-r="Carry" onclick="setRole('Carry')"><span>üèπ Carry</span></button>
    <button class="role-btn" data-r="Support" onclick="setRole('Support')"><span>üíö Support</span></button>
  </div>
  
  <div class="hero-grid" id="heroGrid"></div>
  
  <div class="no-hero" id="noHero" style="display:none">
    <span class="ico">üéÆ</span>
    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ<br>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>+</strong> ‡∏°‡∏∏‡∏°‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà</p>
  </div>
</div>

<!-- Modals ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡∏¢‡πà‡∏≠‡∏•‡∏á) -->
<div class="modal-bg" id="detailModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2 id="dtTitle">‚Äî</h2>
      <button class="modal-close" onclick="closeModal('detailModal')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="detail-hero-row">
        <div class="detail-img" id="dtImg"></div>
        <div class="detail-info">
          <h2 id="dtName"></h2>
          <div class="detail-tags" id="dtTags"></div>
        </div>
      </div>
      <div class="detail-section" id="dtCounterSec" style="display:none">
        <h3>üéØ ‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÅ‡∏Å‡πâ‡∏ó‡∏≤‡∏á</h3>
        <div class="c-grid" id="dtCounterGrid"></div>
      </div>
      <div class="detail-section" id="dtNotesSec" style="display:none">
        <h3>üìù ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå</h3>
        <div class="notes-box" id="dtNotesBox"></div>
      </div>
    </div>
    <div class="modal-ftr">
      <span></span>
      <div class="admin-only" style="display:flex;gap:10px">
        <button class="btn btn-primary" onclick="openEditModal()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn btn-danger" onclick="doDeleteCounter()">üóëÔ∏è ‡∏•‡∏ö</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-bg" id="editModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <div class="edit-thumb" id="editThumb"><div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;color:var(--txt3)">‚öîÔ∏è</div></div>
      <h2 id="editTitle">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Æ‡∏µ‡πÇ‡∏£‡πà</h2>
      <button class="modal-close" onclick="closeModal('editModal')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-grp">
        <label class="form-lbl">üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÅ‡∏Å‡πâ‡∏ó‡∏≤‡∏á</label>
        <div class="picker-wrap">
          <input class="picker-search-inp" id="pickerSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." autocomplete="off">
          <div class="picker-grid" id="pickerGrid"></div>
        </div>
        <div class="picked-list" id="pickedList"></div>
      </div>
      <div class="form-grp">
        <label class="form-lbl">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <textarea class="form-ta" id="editNotes" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå..."></textarea>
      </div>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeModal('editModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn btn-success" onclick="saveEdit()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="libModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2>üìö ‡∏Ñ‡∏•‡∏±‡∏á‡∏Æ‡∏µ‡πÇ‡∏£‡πà</h2>
      <button class="modal-close" onclick="closeModal('libModal')">√ó</button>
    </div>
    <div class="lib-tabs">
      <button class="lib-tab on" id="libTabSel" onclick="switchLibTab('sel')">üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button class="lib-tab" id="libTabAdd" onclick="switchLibTab('add')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div class="lib-body">
      <div id="libSelPane">
        <input class="lib-search" id="libSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." autocomplete="off">
        <div class="lib-grid" id="libGrid"></div>
      </div>
      <div id="libAddPane" style="display:none">
        <div class="qadd-form">
          <div class="qadd-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</div>
          <div class="form-row">
            <input type="text" class="f-inp" id="qName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Æ‡∏µ‡πÇ‡∏£‡πà *">
            <select class="f-sel" id="qRole">
              <option value="">-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
              <option>Tank</option><option>Fighter</option><option>Assassin</option>
              <option>Mage</option><option>Carry</option><option>Support</option>
            </select>
          </div>
          <input type="file" id="qFile" accept="image/*" style="display:none">
          <label for="qFile" class="upload-zone" id="qUpload"><span>üìÅ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span></label>
          <input type="url" class="f-inp" id="qUrl" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á URL" style="margin-bottom:10px">
          <button class="btn-qadd" onclick="addHeroToLib()">üíæ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</button>
        </div>
      </div>
    </div>
    <div class="modal-ftr">
      <span style="color:var(--txt);font-size:.85rem;font-family:'Rajdhani',sans-serif;font-weight:600" id="libSelCount">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß 0</span>
      <div style="display:flex;gap:10px">
        <button class="btn btn-ghost" onclick="closeModal('libModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-success" onclick="confirmLibSel()">‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </div>
  </div>
</div>

<div id="lockOverlay">
  <div class="lock-box">
    <span class="lock-ico">üîê</span>
    <h3>‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Admin</p>
    <input type="password" class="pw-inp" id="pwInp" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    <div class="lock-btns">
      <button class="btn btn-ghost" style="flex:1" onclick="closeLock()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn btn-primary" style="flex:1" onclick="checkPw()">üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å</button>
    </div>
  </div>
</div>

<div id="cfmOverlay">
  <div class="cfm-box">
    <span class="cfm-ico-wrap" id="cfmIco">‚ö†Ô∏è</span>
    <div class="cfm-msg" id="cfmMsg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?</div>
    <div class="cfm-btns">
      <button class="btn btn-ghost" onclick="closeCfm(false)">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn btn-danger" onclick="closeCfm(true)">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE & CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let LIB=[], CTRS=[], role='all', viewId=null, editId=null, picked=[], libSel=[], pendImg='', cfmCb=null, locked=true;
const PW='090344';
const BATCH_SIZE=20; // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞ 20 ‡∏ï‡∏±‡∏ß

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function init(){
  updateLockUI();
  await loadData();
  setupEventListeners();
}

async function loadData(){
  showLoading();
  try{
    // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå heroes-data.js ‡∏Å‡πà‡∏≠‡∏ô
    try{
      const response=await fetch('heroes-data.js');
      const text=await response.text();
      eval(text);
      if(typeof HEROES_DATA!=='undefined') LIB=HEROES_DATA;
      if(typeof COUNTERS_DATA!=='undefined') CTRS=COUNTERS_DATA;
    }catch(e){console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå heroes-data.js');}
    
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
    if(LIB.length===0){
      LIB=JSON.parse(localStorage.getItem('rovLib')||'[]');
      CTRS=JSON.parse(localStorage.getItem('rovCtrs')||'[]');
    }
    
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    if(LIB.length===0){
      LIB=[
        {id:"h1",name:"Veres",image:"https://via.placeholder.com/200x280/131d32/f0b429?text=Veres",role:"Fighter"},
        {id:"h2",name:"Liliana",image:"https://via.placeholder.com/200x280/131d32/4f6ef7?text=Liliana",role:"Mage"},
        {id:"h3",name:"Butterfly",image:"https://via.placeholder.com/200x280/131d32/00e87a?text=Butterfly",role:"Assassin"},
      ];
      CTRS=[{heroId:"h1",counters:["h2","h3"],notes:"‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå"}];
    }
    
    hideLoading();
    toast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','ok');
  }catch(e){
    console.error('Load error:',e);
    hideLoading();
    toast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','err');
  }
  renderGrid();
}

function setupEventListeners(){
  document.getElementById('pwInp').addEventListener('keypress',e=>{if(e.key==='Enter')checkPw()});
  document.getElementById('pickerSearch').addEventListener('input',renderPicker);
  document.getElementById('libSearch').addEventListener('input',renderLibGrid);
  document.getElementById('qFile').addEventListener('change',handleFileUpload);
  ['detailModal','editModal','libModal'].forEach(id=>{
    document.getElementById(id).addEventListener('mousedown',function(e){if(e.target===this)closeModal(id)});
  });
}

function handleFileUpload(e){
  const f=e.target.files[0];if(!f)return;
  const rd=new FileReader();
  rd.onload=ev=>{
    pendImg=ev.target.result;
    const z=document.getElementById('qUpload');
    z.classList.add('has-img');
    z.innerHTML=`<img src="${ev.target.result}" class="upload-preview" alt="preview">`;
  };
  rd.readAsDataURL(f);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LAZY LOADING IMAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const imageObserver=new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      const img=entry.target;
      const src=img.dataset.src;
      if(src){
        img.src=src;
        img.classList.add('loaded');
        imageObserver.unobserve(img);
      }
    }
  });
},{rootMargin:'50px'});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER GRID (‡πÅ‡∏ö‡∏ö Lazy)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setRole(r){
  role=r;
  document.querySelectorAll('.role-btn').forEach(b=>b.classList.toggle('on',b.dataset.r===r));
  renderGrid();
}

function renderGrid(){
  const grid=document.getElementById('heroGrid');
  const none=document.getElementById('noHero');
  let list=LIB.filter(h=>CTRS.some(c=>c.heroId===h.id));
  if(role!=='all')list=list.filter(h=>h.role===role);
  
  if(!list.length){grid.style.display='none';none.style.display='block';return}
  grid.style.display='grid';none.style.display='none';
  grid.innerHTML='';
  
  let idx=0;
  function renderBatch(){
    const batch=list.slice(idx,idx+BATCH_SIZE);
    batch.forEach((h,i)=>{
      const cd=CTRS.find(c=>c.heroId===h.id);
      const cnt=cd&&cd.counters?cd.counters.length:0;
      const el=document.createElement('div');
      el.className='hero-card';
      el.style.animationDelay=`${(idx+i)*0.02}s`;
      el.innerHTML=`
        ${h.image?`<div class="hero-card-img"><img class="lazy-img" data-src="${h.image}" alt="${esc(h.name)}"></div>`:`<div class="hero-card-placeholder">‚ùì</div>`}
        ${h.role?`<div class="hero-card-role">${esc(h.role)}</div>`:''}
        ${cnt>0?`<div class="hero-card-badge">${cnt} CTR</div>`:''}
        <div class="hero-card-name">${esc(h.name)}</div>
      `;
      el.onclick=()=>openDetail(h.id);
      grid.appendChild(el);
      const img=el.querySelector('.lazy-img');
      if(img)imageObserver.observe(img);
    });
    idx+=BATCH_SIZE;
    if(idx<list.length)setTimeout(renderBatch,50);
  }
  renderBatch();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODALS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openModal(id){document.getElementById(id).classList.add('show')}
function closeModal(id){document.getElementById(id).classList.remove('show')}

function openDetail(id){
  if(!id){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','err');return}
  viewId=id;
  const h=LIB.find(x=>x.id===id);
  if(!h){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  const cd=CTRS.find(c=>c.heroId===id);
  
  document.getElementById('dtTitle').textContent=h.name||'‚Äî';
  document.getElementById('dtName').textContent=h.name||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
  document.getElementById('dtImg').innerHTML=h.image
    ?`<img src="${h.image}" alt="${esc(h.name)}">`
    :`<div style="width:100%;height:100%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:3.5rem;color:var(--txt3)">‚ùì</div>`;
  
  const tags=document.getElementById('dtTags');
  tags.innerHTML='';
  if(h.role)tags.innerHTML+=`<div class="tag">üìç ${esc(h.role)}</div>`;
  if(h.lane)tags.innerHTML+=`<div class="tag">üõ£Ô∏è ${esc(h.lane)}</div>`;
  
  const cs=document.getElementById('dtCounterSec');
  if(cd&&cd.counters&&cd.counters.length){
    cs.style.display='block';
    document.getElementById('dtCounterGrid').innerHTML=cd.counters.map(cid=>{
      const ch=LIB.find(x=>x.id===cid);if(!ch)return'';
      return`<div class="c-card"><div class="c-card-img">${ch.image?`<img src="${ch.image}" alt="${esc(ch.name)}">`:`<div style="height:100%;display:flex;align-items:center;justify-content:center;font-size:2rem;color:var(--txt3)">‚ùì</div>`}</div><div class="c-card-name">${esc(ch.name)}</div></div>`;
    }).join('');
  }else{cs.style.display='none'}
  
  const ns=document.getElementById('dtNotesSec');
  if(cd&&cd.notes&&cd.notes.trim()){ns.style.display='block';document.getElementById('dtNotesBox').textContent=cd.notes}
  else{ns.style.display='none'}
  
  openModal('detailModal');
}

function openEditModal(){
  if(locked){toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô','err');return}
  if(!viewId){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','err');return}
  editId=viewId;
  const h=LIB.find(x=>x.id===editId);
  if(!h){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  const cd=CTRS.find(c=>c.heroId===editId);
  
  picked=cd&&cd.counters?[...cd.counters]:[];
  document.getElementById('editNotes').value=cd&&cd.notes?cd.notes:'';
  
  const th=document.getElementById('editThumb');
  th.innerHTML=h.image?`<img src="${h.image}" alt="">`:`<div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.1rem;color:var(--txt3)">‚öîÔ∏è</div>`;
  document.getElementById('editTitle').textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ${h.name||'‡∏Æ‡∏µ‡πÇ‡∏£‡πà'}`;
  document.getElementById('pickerSearch').value='';
  
  renderPicker();
  renderPickedList();
  closeModal('detailModal');
  openModal('editModal');
}

function renderPicker(){
  const term=document.getElementById('pickerSearch').value.trim().toLowerCase();
  const grid=document.getElementById('pickerGrid');
  const list=LIB.filter(h=>h.id!==editId&&(!term||h.name.toLowerCase().includes(term)));
  
  if(!list.length){grid.innerHTML=`<div class="picker-empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà</div>`;return}
  
  grid.innerHTML='';
  list.forEach(h=>{
    const isPicked=picked.includes(h.id);
    const el=document.createElement('div');
    el.className='picker-item'+(isPicked?' picked':'');
    el.dataset.hid=h.id;
    el.innerHTML=`
      <div class="picker-item-img">${h.image?`<img src="${h.image}" alt="${esc(h.name)}">`:`<div class="picker-item-ph">‚ùì</div>`}</div>
      <div class="picker-item-name">${esc(h.name)}</div>
      <div class="picker-ck">‚úì</div>
    `;
    el.addEventListener('mousedown',e=>{
      e.preventDefault();
      const idx=picked.indexOf(h.id);
      if(idx>-1){picked.splice(idx,1);el.classList.remove('picked')}
      else{picked.push(h.id);el.classList.add('picked')}
      renderPickedList();
    });
    grid.appendChild(el);
  });
}

function renderPickedList(){
  const wrap=document.getElementById('pickedList');
  if(!picked.length){wrap.innerHTML='<span class="picked-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>';return}
  wrap.innerHTML=picked.map(hid=>{
    const h=LIB.find(x=>x.id===hid);if(!h)return'';
    return`<span class="picked-tag" data-ptid="${hid}">${h.image?`<img src="${h.image}" alt="${esc(h.name)}">`:''}${esc(h.name)}<button class="picked-tag-rm" data-rm="${hid}">√ó</button></span>`;
  }).join('');
  wrap.querySelectorAll('[data-rm]').forEach(btn=>{
    btn.addEventListener('mousedown',e=>{
      e.stopPropagation();
      const hid=btn.dataset.rm;
      picked=picked.filter(x=>x!==hid);
      const pi=document.querySelector(`.picker-item[data-hid="${hid}"]`);
      if(pi)pi.classList.remove('picked');
      renderPickedList();
    });
  });
}

async function saveEdit(){
  if(!editId){toast('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','err');return}
  const ctr={heroId:editId,counters:[...picked],notes:document.getElementById('editNotes').value.trim()};
  const i=CTRS.findIndex(c=>c.heroId===editId);
  if(i<0)CTRS.push(ctr);else CTRS[i]=ctr;
  localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
  closeModal('editModal');
  toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ','ok');
  openDetail(editId);
}

function doDeleteCounter(){
  if(locked){toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å','err');return}
  const h=LIB.find(x=>x.id===viewId);
  if(!h){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  confirm2('üóëÔ∏è',`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á "${h.name}"?`,()=>{
    CTRS=CTRS.filter(c=>c.heroId!==viewId);
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    closeModal('detailModal');
    viewId=null;
    toast('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','ok');
    renderGrid();
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LIBRARY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openAddHero(){
  if(locked){toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô','err');return}
  libSel=[];
  document.getElementById('libSearch').value='';
  renderLibGrid();
  switchLibTab('sel');
  openModal('libModal');
}

function switchLibTab(t){
  document.getElementById('libTabSel').classList.toggle('on',t==='sel');
  document.getElementById('libTabAdd').classList.toggle('on',t==='add');
  document.getElementById('libSelPane').style.display=t==='sel'?'block':'none';
  document.getElementById('libAddPane').style.display=t==='add'?'block':'none';
}

function renderLibGrid(){
  const term=document.getElementById('libSearch').value.trim().toLowerCase();
  const grid=document.getElementById('libGrid');
  const list=LIB.filter(h=>!term||h.name.toLowerCase().includes(term));
  grid.innerHTML='';
  
  if(!list.length){grid.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--txt3)">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà<br>‡∏Å‡∏î "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÉ‡∏´‡∏°‡πà"</div>`;document.getElementById('libSelCount').textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${libSel.length}`;return}
  
  list.forEach(h=>{
    const isSel=libSel.includes(h.id);
    const el=document.createElement('div');
    el.className='lib-item'+(isSel?' lib-selected':'');
    el.dataset.hid=h.id;
    el.innerHTML=`
      <div class="lib-item-inner">${h.image?`<img src="${h.image}" alt="${esc(h.name)}">`:`<div class="lib-item-ph">‚ùì</div>`}</div>
      <div class="lib-item-name">${esc(h.name)}</div>
      <div class="lib-ck">‚úì</div>
      ${!locked?`<button class="lib-item-del">√ó</button>`:''}
    `;
    el.addEventListener('mousedown',e=>{
      if(e.target.classList.contains('lib-item-del'))return;
      e.preventDefault();
      const idx=libSel.indexOf(h.id);
      if(idx>-1){libSel.splice(idx,1);el.classList.remove('lib-selected')}
      else{libSel.push(h.id);el.classList.add('lib-selected')}
      document.getElementById('libSelCount').textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${libSel.length}`;
    });
    const delBtn=el.querySelector('.lib-item-del');
    if(delBtn){
      delBtn.addEventListener('mousedown',e=>{e.stopPropagation();e.preventDefault()});
      delBtn.addEventListener('click',e=>{e.stopPropagation();doDelFromLib(h.id)});
    }
    grid.appendChild(el);
  });
  document.getElementById('libSelCount').textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${libSel.length}`;
}

async function confirmLibSel(){
  if(!libSel.length){toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  let added=0;
  for(const hid of libSel){
    if(!CTRS.find(c=>c.heroId===hid)){
      CTRS.push({heroId:hid,counters:[],notes:''});
      added++;
    }
  }
  localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
  closeModal('libModal');
  renderGrid();
  
  if(libSel.length===1){
    viewId=libSel[0];
    openDetail(viewId);
  }
  toast(added?`‡πÄ‡∏û‡∏¥‡πà‡∏° ${added} ‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß`:'‡∏Æ‡∏µ‡πÇ‡∏£‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß','ok');
}

function doDelFromLib(hid){
  if(locked)return;
  const h=LIB.find(x=>x.id===hid);
  if(!h){toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  confirm2('üóëÔ∏è',`‡∏•‡∏ö "${h.name}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á?`,()=>{
    LIB=LIB.filter(x=>x.id!==hid);
    CTRS=CTRS.filter(c=>c.heroId!==hid);
    CTRS.forEach(c=>{c.counters=(c.counters||[]).filter(x=>x!==hid)});
    libSel=libSel.filter(x=>x!==hid);
    picked=picked.filter(x=>x!==hid);
    localStorage.setItem('rovLib',JSON.stringify(LIB));
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderLibGrid();
    renderGrid();
    if(document.getElementById('editModal').classList.contains('show')){renderPicker();renderPickedList()}
    toast('‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß','ok');
  });
}

async function addHeroToLib(){
  const name=document.getElementById('qName').value.trim();
  if(!name){toast('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Æ‡∏µ‡πÇ‡∏£‡πà','err');return}
  if(LIB.some(h=>h.name.toLowerCase()===name.toLowerCase())){toast('‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥','err');return}
  const url=document.getElementById('qUrl').value.trim();
  const hero={id:Date.now().toString(),name,image:pendImg||url||'',role:document.getElementById('qRole').value,lane:''};
  LIB.push(hero);
  localStorage.setItem('rovLib',JSON.stringify(LIB));
  document.getElementById('qName').value='';
  document.getElementById('qRole').value='';
  document.getElementById('qUrl').value='';
  document.getElementById('qFile').value='';
  pendImg='';
  const z=document.getElementById('qUpload');
  z.classList.remove('has-img');
  z.innerHTML='<span>üìÅ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</span>';
  renderLibGrid();
  if(document.getElementById('editModal').classList.contains('show'))renderPicker();
  toast(`‡πÄ‡∏û‡∏¥‡πà‡∏° "${name}" ‡πÅ‡∏•‡πâ‡∏ß`,'ok');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOCK & CONFIRM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateLockUI(){
  const btn=document.getElementById('lockBtn');
  if(locked){
    btn.textContent='üîí';
    btn.classList.remove('open');
    document.body.classList.add('read-mode');
  }else{
    btn.textContent='üîì';
    btn.classList.add('open');
    document.body.classList.remove('read-mode');
  }
}

function toggleLock(){
  if(locked){openLock()}
  else{
    confirm2('üîí','‡∏•‡πá‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',()=>{
      locked=true;
      updateLockUI();
      toast('‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß','ok');
    });
  }
}

function openLock(){
  const i=document.getElementById('pwInp');
  i.value='';i.style.borderColor='';i.placeholder='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
  document.getElementById('lockOverlay').classList.add('show');
  setTimeout(()=>i.focus(),80);
}

function closeLock(){document.getElementById('lockOverlay').classList.remove('show')}

function checkPw(){
  const i=document.getElementById('pwInp');
  if(i.value===PW){
    locked=false;
    updateLockUI();
    closeLock();
    toast('‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üîì','ok');
  }else{
    i.style.borderColor='var(--red)';
    i.value='';
    i.placeholder='‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚ùå';
    setTimeout(()=>{i.style.borderColor='';i.placeholder='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'},1500);
  }
}

function confirm2(ico,msg,cb){
  document.getElementById('cfmIco').textContent=ico;
  document.getElementById('cfmMsg').textContent=msg;
  cfmCb=cb;
  document.getElementById('cfmOverlay').classList.add('show');
}

function closeCfm(yes){
  document.getElementById('cfmOverlay').classList.remove('show');
  if(yes&&typeof cfmCb==='function')cfmCb();
  cfmCb=null;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showLoading(){document.getElementById('loadingOverlay').classList.add('show')}
function hideLoading(){document.getElementById('loadingOverlay').classList.remove('show')}

function toast(msg,type='ok'){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  const ico=type==='ok'?'‚úÖ':type==='info'?'‚ÑπÔ∏è':'‚ùå';
  t.innerHTML=`<span>${ico}</span><span>${esc(msg)}</span>`;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3200);
}

function esc(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
init();
</script>
</body>
</html>
