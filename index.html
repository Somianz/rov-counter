<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROV Hero Counter Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg0:#070b14;--bg1:#0f1420;--bg2:#161c2e;--bg3:#1e2640;
  --txt:#e8eaf6;--txt2:#8892b0;--txt3:#4a5580;
  --blue:#5865f2;--blue2:#4752c4;--green:#00d97e;--red:#ee5a6f;
  --bdr:rgba(255,255,255,0.08);
  --r10:10px;--r14:14px;--r20:20px;
}
body{font-family:'Kanit',sans-serif;background:var(--bg0);color:var(--txt);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(circle at 15% 25%,rgba(88,101,242,.18) 0,transparent 55%),radial-gradient(circle at 85% 75%,rgba(0,217,126,.12) 0,transparent 55%);pointer-events:none;z-index:0}
img{display:block;width:100%;height:100%;object-fit:cover}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg0)}
::-webkit-scrollbar-thumb{background:var(--blue);border-radius:3px}

/* â”€â”€ LAYOUT â”€â”€ */
.wrap{max-width:1500px;margin:0 auto;padding:20px;position:relative;z-index:1}
.hdr{text-align:center;padding:28px 20px 16px;margin-bottom:24px}
.hdr h1{font-size:2.4rem;font-weight:700;background:linear-gradient(135deg,#5865f2,#00d97e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr p{color:var(â€“txt2);margin-top:6px}

/* â”€â”€ SETUP BANNER (hidden) â”€â”€ */
#setupBanner{display:none}

/* â”€â”€ SYNC STATUS â”€â”€ */
#syncBar{display:flex;align-items:center;gap:10px;justify-content:center;margin-bottom:16px;font-size:.82rem;color:var(â€“txt3)}
.sync-dot{width:8px;height:8px;border-radius:50%;background:var(â€“txt3);flex-shrink:0;transition:background .3s}
.sync-dot.ok{background:var(â€“green);box-shadow:0 0 8px rgba(0,217,126,.5)}
.sync-dot.err{background:var(â€“red)}
.sync-dot.loading{background:var(â€“blue);animation:pulse .8s infinite}
@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}

/* â”€â”€ LOCK BTN â”€â”€ */
#lockBtn{position:fixed;top:18px;right:18px;width:42px;height:42px;background:var(â€“bg2);border:1.5px solid var(â€“bdr);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:9999;font-size:1.25rem;box-shadow:0 2px 12px rgba(0,0,0,.4);transition:all .25s}
#lockBtn:hover{background:var(â€“bg3);transform:scale(1.08)}
#lockBtn.open{border-color:var(â€“green);box-shadow:0 0 18px rgba(0,217,126,.35)}

/* â”€â”€ ROLE FILTER â”€â”€ */
.roles{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:26px}
.role-btn{padding:10px 20px;background:var(â€“bg2);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);color:var(â€“txt2);font-family:inherit;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .25s}
.role-btn:hover{border-color:var(â€“blue);color:var(â€“blue);transform:translateY(-2px)}
.role-btn.on{background:linear-gradient(135deg,var(â€“blue),var(â€“blue2));border-color:var(â€“blue);color:#fff;box-shadow:0 0 18px rgba(88,101,242,.45)}

/* â”€â”€ HERO GRID â”€â”€ */
.hero-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:28px;animation:fadeUp .5s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.hero-card{aspect-ratio:1;background:var(â€“bg2);border-radius:var(â€“r14);overflow:hidden;cursor:pointer;position:relative;border:2px solid var(â€“green);transition:all .25s}
.hero-card:hover{transform:translateY(-7px) scale(1.04);box-shadow:0 8px 28px rgba(88,101,242,.4);z-index:5}
.hero-card-img{width:100%;height:100%;position:relative}
.hero-card-img img{width:100%;height:100%;object-fit:cover}
.hero-card-name{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(0,0,0,.9),transparent);padding:14px 8px 8px;text-align:center;font-size:.82rem;font-weight:600}
.hero-card-badge{position:absolute;top:7px;right:7px;background:var(â€“green);color:#fff;font-size:.7rem;font-weight:700;padding:3px 8px;border-radius:10px}
.hero-card-role{position:absolute;top:7px;left:7px;background:rgba(0,0,0,.65);backdrop-filter:blur(6px);font-size:.68rem;font-weight:600;padding:3px 7px;border-radius:5px}
.no-hero{text-align:center;padding:70px 20px;color:var(â€“txt2)}
.no-hero .ico{font-size:4.5rem;opacity:.4;margin-bottom:16px}

/* â”€â”€ MODAL BASE â”€â”€ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.82);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;padding:20px}
.modal-bg.show{display:flex}
#detailModal{z-index:2100}
#editModal{z-index:2200}
#libModal{z-index:2300}
#lockOverlay,#cfmOverlay{z-index:2400}

.modal-box{background:var(â€“bg1);border-radius:var(â€“r14);border:1px solid var(â€“bdr);box-shadow:0 12px 40px rgba(0,0,0,.6);width:100%;animation:popIn .35s ease}
@keyframes popIn{from{opacity:0;transform:scale(.93) translateY(30px)}to{opacity:1;transform:none}}
.modal-hdr{padding:22px 26px;background:var(â€“bg2);border-bottom:1px solid var(â€“bdr);border-radius:var(â€“r14) var(â€“r14) 0 0;display:flex;align-items:center;gap:12px}
.modal-hdr h2{font-size:1.3rem;font-weight:700;flex:1}
.modal-close{width:32px;height:32px;background:rgba(0,0,0,.4);border:none;border-radius:50%;color:#fff;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .25s;flex-shrink:0;line-height:1}
.modal-close:hover{background:var(â€“red);transform:rotate(90deg)}
.modal-body{padding:24px 26px;overflow-y:auto}
.modal-ftr{padding:16px 26px;background:var(â€“bg2);border-top:1px solid var(â€“bdr);border-radius:0 0 var(â€“r14) var(â€“r14);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-shrink:0}

/* â”€â”€ DETAIL MODAL â”€â”€ */
#detailModal .modal-box{max-width:860px;max-height:90vh;display:flex;flex-direction:column}
.detail-hero-row{display:flex;gap:24px;align-items:flex-start}
.detail-img{width:130px;height:130px;border-radius:var(â€“r10);overflow:hidden;border:2.5px solid var(â€“blue);box-shadow:0 0 24px rgba(88,101,242,.45);flex-shrink:0}
.detail-info h2{font-size:1.8rem;font-weight:700;background:linear-gradient(135deg,var(â€“blue),var(â€“green));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
.detail-tags{display:flex;gap:8px;flex-wrap:wrap}
.tag{padding:5px 12px;background:var(â€“bg3);border-radius:16px;font-size:.8rem;color:var(â€“txt2);border:1px solid var(â€“bdr)}
.detail-section{margin-top:22px}
.detail-section h3{font-size:1.05rem;font-weight:600;color:var(â€“blue);margin-bottom:12px}
.c-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px}
.c-card{background:var(â€“bg3);border-radius:var(â€“r10);overflow:hidden;border:1px solid var(â€“bdr)}
.c-card-img{aspect-ratio:1;background:var(â€“bg2)}
.c-card-name{padding:6px 4px;text-align:center;font-size:.75rem;font-weight:600;color:var(â€“txt2)}
.notes-box{background:var(â€“bg3);border-radius:var(â€“r10);padding:16px;border:1px solid var(â€“bdr);color:var(â€“txt2);line-height:1.8;white-space:pre-wrap;font-size:.9rem}

/* â”€â”€ EDIT MODAL â”€â”€ */
#editModal .modal-box{max-width:700px;max-height:92vh;display:flex;flex-direction:column}
.edit-thumb{width:40px;height:40px;border-radius:8px;overflow:hidden;border:2px solid var(â€“blue);flex-shrink:0}
.form-lbl{font-size:.85rem;font-weight:600;margin-bottom:8px;display:block;color:var(â€“txt2)}
.form-grp{margin-bottom:22px}
.form-ta{width:100%;min-height:110px;padding:12px;background:var(â€“bg3);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);color:var(â€“txt);font-family:inherit;font-size:.9rem;resize:vertical}
.form-ta:focus{outline:none;border-color:var(â€“blue)}

/* INLINE COUNTER PICKER */
.picker-wrap{background:var(â€“bg3);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);overflow:hidden}
.picker-search-inp{width:100%;padding:10px 14px;background:var(â€“bg2);border:none;border-bottom:1.5px solid var(â€“bdr);color:var(â€“txt);font-family:inherit;font-size:.88rem}
.picker-search-inp:focus{outline:none}
.picker-search-inp::placeholder{color:var(â€“txt3)}
.picker-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(82px,1fr));gap:8px;padding:12px;max-height:280px;overflow-y:auto}
.picker-item{aspect-ratio:1;background:var(â€“bg2);border-radius:var(â€“r10);overflow:hidden;cursor:pointer;position:relative;border:2px solid transparent;transition:border-color .15s,box-shadow .15s;user-select:none}
.picker-item:hover{border-color:var(â€“blue)}
.picker-item.picked{border-color:var(â€“green);box-shadow:0 0 10px rgba(0,217,126,.3)}
.picker-item.picked::after{content:â€˜âœ“â€™;position:absolute;top:3px;right:3px;width:20px;height:20px;background:var(â€“green);border-radius:50%;font-size:.75rem;font-weight:700;display:flex;align-items:center;justify-content:center;line-height:20px;text-align:center;z-index:2;pointer-events:none}
.picker-item-img{width:100%;height:calc(100% - 22px)}
.picker-item-name{font-size:.68rem;font-weight:600;text-align:center;padding:3px 2px;color:var(â€“txt2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.picker-empty{padding:24px;text-align:center;color:var(â€“txt3);font-size:.85rem;grid-column:1/-1}
.picked-list{display:flex;flex-wrap:wrap;gap:7px;margin-top:10px;min-height:20px}
.picked-tag{padding:5px 10px;background:rgba(0,217,126,.1);border:1px solid var(â€“green);border-radius:var(â€“r20);font-size:.78rem;color:var(â€“green);display:inline-flex;align-items:center;gap:6px}
.picked-tag img{width:20px;height:20px;border-radius:4px;flex-shrink:0;object-fit:cover}
.picked-tag-rm{cursor:pointer;color:rgba(0,217,126,.55);font-size:1.05rem;line-height:1;padding:0 2px;transition:color .18s;border:none;background:none;font-family:inherit}
.picked-tag-rm:hover{color:var(â€“red)}
.picked-empty{color:var(â€“txt3);font-size:.82rem}

/* â”€â”€ LIBRARY MODAL â”€â”€ */
#libModal .modal-box{max-width:1100px;max-height:90vh;display:flex;flex-direction:column}
.lib-tabs{display:flex;background:var(â€“bg2);border-bottom:2px solid var(â€“bdr);flex-shrink:0}
.lib-tab{padding:14px 24px;background:transparent;border:none;color:var(â€“txt2);font-family:inherit;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all .25s;font-size:.9rem}
.lib-tab:hover{color:var(â€“blue)}
.lib-tab.on{color:var(â€“blue);border-bottom-color:var(â€“blue)}
.lib-body{flex:1;overflow-y:auto;padding:20px 26px}
.lib-search{width:100%;padding:10px 14px;background:var(â€“bg3);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);color:var(â€“txt);font-family:inherit;font-size:.9rem;margin-bottom:16px}
.lib-search:focus{outline:none;border-color:var(â€“blue)}
.lib-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px}
.lib-item{aspect-ratio:1;background:var(â€“bg3);border-radius:var(â€“r10);overflow:hidden;position:relative;border:2px solid var(â€“bdr);transition:all .2s;cursor:pointer}
.lib-item:hover{border-color:var(â€“blue)}
.lib-item.lib-selected{border-color:var(â€“green);box-shadow:0 0 12px rgba(0,217,126,.3)}
.lib-item.lib-selected::after{content:â€˜âœ“â€™;position:absolute;top:3px;right:3px;width:20px;height:20px;background:var(â€“green);border-radius:50%;font-size:.75rem;font-weight:700;display:flex;align-items:center;justify-content:center;line-height:20px;z-index:2;pointer-events:none}
.lib-item-inner{width:100%;height:calc(100% - 24px)}
.lib-item-name{font-size:.7rem;font-weight:600;text-align:center;padding:4px 3px;color:var(â€“txt2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lib-item-del{position:absolute;top:4px;right:4px;width:22px;height:22px;background:var(â€“red);border:none;border-radius:50%;color:#fff;font-size:.9rem;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:3;line-height:1;padding:0;font-family:inherit}
.lib-item:hover .lib-item-del{display:flex}
.read-mode .lib-item-del{display:none!important}
/* quick add */
.qadd-form{background:var(â€“bg3);border-radius:var(â€“r10);padding:20px;border:2px dashed var(â€“bdr)}
.qadd-title{font-size:1rem;font-weight:700;color:var(â€“blue);margin-bottom:14px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.f-inp,.f-sel{width:100%;padding:9px 12px;background:var(â€“bg2);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);color:var(â€“txt);font-family:inherit;font-size:.88rem}
.f-inp:focus,.f-sel:focus{outline:none;border-color:var(â€“blue)}
.f-sel option{background:var(â€“bg2)}
.upload-zone{border:2px dashed var(â€“bdr);border-radius:var(â€“r10);padding:18px;text-align:center;cursor:pointer;transition:all .25s;display:flex;align-items:center;justify-content:center;min-height:64px;margin-bottom:10px}
.upload-zone:hover{border-color:var(â€“blue);background:rgba(88,101,242,.05)}
.upload-zone.has-img{padding:4px}
.upload-preview{width:100%;max-height:140px;object-fit:contain;border-radius:var(â€“r10)}
.btn-qadd{width:100%;padding:11px;background:var(â€“blue);color:#fff;border:none;border-radius:var(â€“r10);font-family:inherit;font-weight:700;cursor:pointer;transition:all .25s;font-size:.9rem}
.btn-qadd:hover{background:var(â€“blue2)}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{padding:9px 20px;border-radius:var(â€“r10);font-family:inherit;font-weight:700;cursor:pointer;transition:all .25s;font-size:.88rem;display:inline-flex;align-items:center;gap:6px;border:none}
.btn-ghost{background:transparent;border:1.5px solid var(â€“bdr);color:var(â€“txt2)}
.btn-ghost:hover{border-color:var(â€“txt2);color:var(â€“txt)}
.btn-primary{background:var(â€“blue);color:#fff}
.btn-primary:hover{background:var(â€“blue2)}
.btn-success{background:var(â€“green);color:#fff}
.btn-success:hover{background:#00b56a}
.btn-danger{background:var(â€“red);color:#fff}
.btn-danger:hover{background:#d94d61}
.btn-warn{background:#f7b731;color:#000}
.btn-warn:hover{background:#e0a820}

/* â”€â”€ FAB â”€â”€ */
#fab{position:fixed;bottom:28px;right:28px;width:56px;height:56px;background:linear-gradient(135deg,var(â€“blue),var(â€“blue2));border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.9rem;color:#fff;box-shadow:0 4px 18px rgba(88,101,242,.5);transition:all .3s;z-index:999}
#fab:hover{transform:scale(1.1) rotate(90deg)}
.read-mode #fab{display:none}
.read-mode .admin-only{display:none!important}

/* â”€â”€ LOCK / CONFIRM OVERLAY â”€â”€ */
#lockOverlay,#cfmOverlay{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center}
#lockOverlay.show,#cfmOverlay.show{display:flex}
.lock-box,.cfm-box{background:var(â€“bg2);border-radius:var(â€“r14);padding:36px;max-width:380px;width:90%;border:1px solid var(â€“bdr);text-align:center}
.lock-ico,.cfm-ico-wrap{font-size:3.5rem;margin-bottom:14px}
.lock-box h3,.cfm-box h3{font-size:1.3rem;margin-bottom:8px}
.lock-box p,.cfm-msg{color:var(â€“txt2);font-size:.88rem;margin-bottom:18px;line-height:1.6}
.pw-inp{width:100%;padding:13px;background:var(â€“bg3);border:1.5px solid var(â€“bdr);border-radius:var(â€“r10);color:var(â€“txt);font-size:1rem;text-align:center;letter-spacing:3px;margin-bottom:14px;font-family:inherit}
.pw-inp:focus{outline:none;border-color:var(â€“blue)}
.lock-btns,.cfm-btns{display:flex;gap:10px;justify-content:center}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%);background:var(â€“bg2);color:var(â€“txt);padding:13px 20px;border-radius:var(â€“r10);box-shadow:0 8px 28px rgba(0,0,0,.5);border:1px solid var(â€“bdr);z-index:9999;display:flex;align-items:center;gap:10px;animation:toastIn .3s ease;white-space:nowrap;font-size:.88rem;font-weight:500}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(14px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
.toast.ok{border-left:4px solid var(â€“green)}
.toast.err{border-left:4px solid var(â€“red)}
.toast.info{border-left:4px solid var(â€“blue)}

/* loading skeleton */
.skeleton{background:linear-gradient(90deg,var(â€“bg2) 25%,var(â€“bg3) 50%,var(â€“bg2) 75%);background-size:200% 100%;animation:shimmer 1.2s infinite}
@keyframes shimmer{to{background-position:-200% 0}}

@media(max-width:1100px){.hero-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.hero-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:540px){.hero-grid{grid-template-columns:repeat(2,1fr)}.hdr h1{font-size:1.7rem}.detail-hero-row{flex-direction:column}.form-row{grid-template-columns:1fr}}
</style>

</head>
<body>

<button id="lockBtn" onclick="toggleLock()">ğŸ”’</button>

<div id="fab" onclick="openAddHero()">+</div>

<div class="wrap">
  <div class="hdr">
    <h1>âš”ï¸ ROV Hero Counter</h1>
    <p>à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œà¹à¸¥à¸°à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œ</p>
  </div>

  <!-- sync status (hidden by default, shows only on error) -->

  <div id="syncBar" style="display:none">
    <div class="sync-dot loading" id="syncDot"></div>
    <span id="syncText">à¸à¸³à¸¥à¸±à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­...</span>
  </div>
  <div id="setupBanner" style="display:none"></div>

  <div class="roles">
    <button class="role-btn on" data-r="all"      onclick="setRole('all')">ğŸ¯ à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
    <button class="role-btn" data-r="Tank"         onclick="setRole('Tank')">ğŸ›¡ï¸ Tank</button>
    <button class="role-btn" data-r="Warrior"      onclick="setRole('Warrior')">âš”ï¸ Warrior</button>
    <button class="role-btn" data-r="Assassin"     onclick="setRole('Assassin')">ğŸ—¡ï¸ Assassin</button>
    <button class="role-btn" data-r="Mage"         onclick="setRole('Mage')">ğŸ”® Mage</button>
    <button class="role-btn" data-r="Marksman"     onclick="setRole('Marksman')">ğŸ¹ Marksman</button>
    <button class="role-btn" data-r="Support"      onclick="setRole('Support')">ğŸ’š Support</button>
  </div>
  <div class="hero-grid" id="heroGrid"></div>
  <div class="no-hero" id="noHero" style="display:none"><div class="ico">ğŸ®</div><div>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸™à¸«à¸¡à¸§à¸”à¸™à¸µà¹‰<br>à¸à¸”à¸›à¸¸à¹ˆà¸¡ + à¸¡à¸¸à¸¡à¸¥à¹ˆà¸²à¸‡à¸‚à¸§à¸²à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆ</div></div>
</div>

<!-- â•â•â•â• DETAIL MODAL â•â•â•â• -->

<div class="modal-bg" id="detailModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2 id="dtTitle">â€”</h2>
      <button class="modal-close" onclick="closeModal('detailModal')">Ã—</button>
    </div>
    <div class="modal-body" style="flex:1;overflow-y:auto">
      <div class="detail-hero-row">
        <div class="detail-img" id="dtImg"></div>
        <div class="detail-info"><h2 id="dtName"></h2><div class="detail-tags" id="dtTags"></div></div>
      </div>
      <div class="detail-section" id="dtCounterSec" style="display:none">
        <h3>ğŸ¯ à¸®à¸µà¹‚à¸£à¹ˆà¹à¸à¹‰à¸—à¸²à¸‡</h3>
        <div class="c-grid" id="dtCounterGrid"></div>
      </div>
      <div class="detail-section" id="dtNotesSec" style="display:none">
        <h3>ğŸ“ à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¹à¸¥à¸°à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸</h3>
        <div class="notes-box" id="dtNotesBox"></div>
      </div>
    </div>
    <div class="modal-ftr">
      <span></span>
      <div class="admin-only" style="display:flex;gap:10px">
        <button class="btn btn-primary" onclick="openEditModal()">âœï¸ à¹à¸à¹‰à¹„à¸‚</button>
        <button class="btn btn-danger"  onclick="doDeleteCounter()">ğŸ—‘ï¸ à¸¥à¸š</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â• EDIT MODAL â•â•â•â• -->

<div class="modal-bg" id="editModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <div class="edit-thumb" id="editThumb"><div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.2rem">âš”ï¸</div></div>
      <h2 id="editTitle">à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ</h2>
      <button class="modal-close" onclick="closeModal('editModal')">Ã—</button>
    </div>
    <div class="modal-body" style="flex:1;overflow-y:auto">
      <div class="form-grp">
        <label class="form-lbl">ğŸ¯ à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹à¸à¹‰à¸—à¸²à¸‡ â€” à¸à¸”à¸—à¸µà¹ˆà¸à¸²à¸£à¹Œà¸”à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸ / à¸à¸”à¸‹à¹‰à¸³à¹€à¸à¸·à¹ˆà¸­à¸¢à¸à¹€à¸¥à¸´à¸</label>
        <div class="picker-wrap">
          <input class="picker-search-inp" id="pickerSearch" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸®à¸µà¹‚à¸£à¹ˆ..." autocomplete="off">
          <div class="picker-grid" id="pickerGrid"></div>
        </div>
        <div class="picked-list" id="pickedList"></div>
      </div>
      <div class="form-grp">
        <label class="form-lbl">ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ / à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œ</label>
        <textarea class="form-ta" id="editNotes" placeholder="à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡..."></textarea>
      </div>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeModal('editModal')">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-success" onclick="saveEdit()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• LIBRARY MODAL â•â•â•â• -->

<div class="modal-bg" id="libModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2>ğŸ“š à¸„à¸¥à¸±à¸‡à¸®à¸µà¹‚à¸£à¹ˆ</h2>
      <button class="modal-close" onclick="closeModal('libModal')">Ã—</button>
    </div>
    <div class="lib-tabs">
      <button class="lib-tab on" id="libTabSel" onclick="switchLibTab('sel')">ğŸ¯ à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š</button>
      <button class="lib-tab"    id="libTabAdd" onclick="switchLibTab('add')">â• à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</button>
    </div>
    <div class="lib-body">
      <div id="libSelPane">
        <input class="lib-search" id="libSearch" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸®à¸µà¹‚à¸£à¹ˆ..." autocomplete="off">
        <div class="lib-grid" id="libGrid"></div>
      </div>
      <div id="libAddPane" style="display:none">
        <div class="qadd-form">
          <div class="qadd-title">â• à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</div>
          <div class="form-row">
            <input type="text" class="f-inp" id="qName" placeholder="à¸Šà¸·à¹ˆà¸­à¸®à¸µà¹‚à¸£à¹ˆ *">
            <select class="f-sel" id="qRole">
              <option value="">-- à¸›à¸£à¸°à¹€à¸ à¸— --</option>
              <option>Tank</option><option>Warrior</option><option>Assassin</option>
              <option>Mage</option><option>Marksman</option><option>Support</option>
            </select>
          </div>
          <input type="file" id="qFile" accept="image/*" style="display:none">
          <label for="qFile" class="upload-zone" id="qUpload"><span>ğŸ“ à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸ à¸²à¸</span></label>
          <input type="url" class="f-inp" id="qUrl" placeholder="à¸«à¸£à¸·à¸­à¸§à¸²à¸‡ URL à¸£à¸¹à¸›à¸ à¸²à¸" style="margin-bottom:10px">
          <button class="btn-qadd" onclick="addHeroToLib()">ğŸ’¾ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</button>
        </div>
      </div>
    </div>
    <div class="modal-ftr">
      <span style="color:var(--txt2);font-size:.85rem" id="libSelCount">à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ 0 à¸®à¸µà¹‚à¸£à¹ˆ</span>
      <div style="display:flex;gap:10px">
        <button class="btn btn-ghost" onclick="closeModal('libModal')">à¸¢à¸à¹€à¸¥à¸´à¸</button>
        <button class="btn btn-success" onclick="confirmLibSel()">âœ“ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ LOCK â”€â”€ -->

<div id="lockOverlay">
  <div class="lock-box">
    <div class="lock-ico">ğŸ”</div>
    <h3>à¸›à¹‰à¸­à¸™à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™</h3>
    <p>à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸à¸·à¹ˆà¸­à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¹‚à¸«à¸¡à¸”à¹à¸­à¸”à¸¡à¸´à¸™</p>
    <input type="password" class="pw-inp" id="pwInp" placeholder="à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™">
    <div class="lock-btns">
      <button class="btn btn-ghost" style="flex:1" onclick="closeLock()">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-primary" style="flex:1" onclick="checkPw()">à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸</button>
    </div>
  </div>
</div>

<!-- â”€â”€ CONFIRM â”€â”€ -->

<div id="cfmOverlay">
  <div class="cfm-box">
    <div class="cfm-ico-wrap" id="cfmIco">âš ï¸</div>
    <div class="cfm-msg" id="cfmMsg">à¸¢à¸·à¸™à¸¢à¸±à¸™?</div>
    <div class="cfm-btns">
      <button class="btn btn-ghost" onclick="closeCfm(false)">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-danger" onclick="closeCfm(true)">à¸¢à¸·à¸™à¸¢à¸±à¸™</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Firebase SDK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script type="module">
import { initializeApp }            from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { getFirestore, collection, doc, getDocs, setDoc, deleteDoc, onSnapshot, writeBatch }
                                    from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let LIB    = [];
let CTRS   = [];
let role   = 'all';
let viewId = null;
let editId = null;
let picked = [];
let libSel = [];
let pendImg= '';
let cfmCb  = null;
let locked = true;
let fbApp  = null;
let db     = null;
let useFirebase = false;
let unsubLib  = null;
let unsubCtrs = null;
const PW   = '090344';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE CONFIG (hardcoded)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyDupvulALaqs2Pe1oiF6-9M451f0hT5vws",
  authDomain: "rov-counter-guide.firebaseapp.com",
  projectId: "rov-counter-guide",
  storageBucket: "rov-counter-guide.firebasestorage.app",
  messagingSenderId: "462634926139",
  appId: "1:462634926139:web:3e9f63d252183295621c1e",
  measurementId: "G-FMZ2V0DVE0"
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init(){
  // à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Firebase à¹‚à¸”à¸¢à¸•à¸£à¸‡ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸­à¸µà¸à¹à¸¥à¹‰à¸§
  await connectFirebase(FIREBASE_CONFIG);

  updateLockUI();

  document.getElementById('pwInp').addEventListener('keypress', e=>{ if(e.key==='Enter') checkPw(); });
  document.getElementById('pickerSearch').addEventListener('input', renderPicker);
  document.getElementById('libSearch').addEventListener('input', renderLibGrid);
  document.getElementById('qFile').addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f) return;
    const rd=new FileReader();
    rd.onload=ev=>{
      pendImg=ev.target.result;
      const z=document.getElementById('qUpload');
      z.classList.add('has-img');
      z.innerHTML=`<img src="${ev.target.result}" class="upload-preview" alt="preview">`;
    };
    rd.readAsDataURL(f);
  });
  ['detailModal','editModal','libModal'].forEach(id=>{
    document.getElementById(id).addEventListener('mousedown',function(e){ if(e.target===this) closeModal(id); });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE CONNECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function connectFirebase(cfg){
  setSyncStatus('loading','à¸à¸³à¸¥à¸±à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Firebase...');
  try{
    // à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ initializeApp à¸‹à¹‰à¸³
    if(!fbApp) fbApp = initializeApp(cfg);
    db = getFirestore(fbApp);

    useFirebase = true;
    setSyncStatus('ok','à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Firebase à¹à¸¥à¹‰à¸§ âœ“');

    // subscribe real-time listeners
    subscribeRealtime();
  }catch(e){
    console.warn('Firebase init error:', e);
    setSyncStatus('err','Firebase à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ â€” à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸–à¸¹à¸à¹€à¸à¹‡à¸šà¹ƒà¸™ localStorage');
    fallbackToLocal();
  }
}

function subscribeRealtime(){
  // unsubscribe à¹€à¸”à¸´à¸¡à¸à¹ˆà¸­à¸™
  if(unsubLib)  unsubLib();
  if(unsubCtrs) unsubCtrs();

  unsubLib = onSnapshot(collection(db,'heroLibrary'), snap=>{
    LIB = snap.docs.map(d=>({id:d.id,...d.data()}));
    renderGrid();
    if(document.getElementById('libModal').classList.contains('show')) renderLibGrid();
    if(document.getElementById('editModal').classList.contains('show')) renderPicker();
  });

  unsubCtrs = onSnapshot(collection(db,'heroCounters'), snap=>{
    CTRS = snap.docs.map(d=>({heroId:d.id,...d.data()}));
    renderGrid();
  });
}

function fallbackToLocal(){
  useFirebase=false;
  setSyncStatus('err','Firebase à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ â€” à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§');
  try{ LIB  = JSON.parse(localStorage.getItem('rovLib') ||'[]') }catch{LIB=[]}
  try{ CTRS = JSON.parse(localStorage.getItem('rovCtrs')||'[]') }catch{CTRS=[]}
  renderGrid();
}

function setSyncStatus(state, text){
  const bar  = document.getElementById('syncBar');
  const dot  = document.getElementById('syncDot');
  const span = document.getElementById('syncText');
  dot.className='sync-dot '+state;
  span.textContent=text;
  // à¹à¸ªà¸”à¸‡ syncBar à¹€à¸‰à¸à¸²à¸°à¸•à¸­à¸™ error à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
  bar.style.display = (state==='err') ? 'flex' : 'none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function saveLib(hero){
  if(useFirebase && db){
    const {id,...data}=hero;
    await setDoc(doc(db,'heroLibrary',id), data);
  } else {
    if(!LIB.find(h=>h.id===hero.id)) LIB.push(hero);
    else { const i=LIB.findIndex(h=>h.id===hero.id); LIB[i]=hero; }
    localStorage.setItem('rovLib', JSON.stringify(LIB));
    renderGrid();
    renderLibGrid();
  }
}

async function saveCtr(ctr){
  if(useFirebase && db){
    const {heroId,...data}=ctr;
    await setDoc(doc(db,'heroCounters',heroId), data);
  } else {
    let c=CTRS.find(x=>x.heroId===ctr.heroId);
    if(!c){ CTRS.push(ctr); } else { Object.assign(c,ctr); }
    localStorage.setItem('rovCtrs', JSON.stringify(CTRS));
    renderGrid();
  }
}

async function deleteLibHero(id){
  if(useFirebase && db){
    const batch=writeBatch(db);
    batch.delete(doc(db,'heroLibrary',id));
    // à¸¥à¸š counter data à¸”à¹‰à¸§à¸¢
    const ctrsSnap=await getDocs(collection(db,'heroCounters'));
    ctrsSnap.docs.forEach(d=>{
      const data=d.data();
      if(d.id===id || (data.counters||[]).includes(id)){
        if(d.id===id){ batch.delete(doc(db,'heroCounters',id)); }
        else {
          batch.update(doc(db,'heroCounters',d.id),{counters:(data.counters||[]).filter(x=>x!==id)});
        }
      }
    });
    await batch.commit();
  } else {
    LIB=LIB.filter(h=>h.id!==id);
    CTRS=CTRS.filter(c=>c.heroId!==id);
    CTRS.forEach(c=>{ c.counters=(c.counters||[]).filter(x=>x!==id); });
    localStorage.setItem('rovLib',JSON.stringify(LIB));
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderGrid(); renderLibGrid();
  }
}

async function deleteCtr(heroId){
  if(useFirebase && db){
    await deleteDoc(doc(db,'heroCounters',heroId));
  } else {
    CTRS=CTRS.filter(c=>c.heroId!==heroId);
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderGrid();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateLockUI(){
  const btn=document.getElementById('lockBtn');
  if(locked){ btn.textContent='ğŸ”’'; btn.classList.remove('open'); document.body.classList.add('read-mode'); }
  else       { btn.textContent='ğŸ”“'; btn.classList.add('open');   document.body.classList.remove('read-mode'); }
}
window.toggleLock=()=>{
  if(locked){ openLock(); }
  else { confirm2('ğŸ”’','à¸¥à¹‡à¸­à¸à¸£à¸°à¸šà¸šà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?',()=>{ locked=true; updateLockUI(); toast('à¸¥à¹‡à¸­à¸à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§','ok'); }); }
};
function openLock(){
  const i=document.getElementById('pwInp'); i.value=''; i.style.borderColor=''; i.placeholder='à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™';
  document.getElementById('lockOverlay').classList.add('show');
  setTimeout(()=>i.focus(),80);
}
window.closeLock=()=>document.getElementById('lockOverlay').classList.remove('show');
window.checkPw=()=>{
  const i=document.getElementById('pwInp');
  if(i.value===PW){ locked=false; updateLockUI(); closeLock(); toast('à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ ğŸ”“','ok'); }
  else { i.style.borderColor='var(--red)'; i.value=''; i.placeholder='à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ âŒ'; setTimeout(()=>{ i.style.borderColor=''; i.placeholder='à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™'; },1400); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIRM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function confirm2(ico,msg,cb){
  document.getElementById('cfmIco').textContent=ico;
  document.getElementById('cfmMsg').textContent=msg;
  cfmCb=cb;
  document.getElementById('cfmOverlay').classList.add('show');
}
window.closeCfm=(yes)=>{
  document.getElementById('cfmOverlay').classList.remove('show');
  if(yes && typeof cfmCb==='function') cfmCb();
  cfmCb=null;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id){ document.getElementById(id).classList.add('show'); }
window.closeModal=(id)=>document.getElementById(id).classList.remove('show');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.setRole=(r)=>{
  role=r;
  document.querySelectorAll('.role-btn').forEach(b=>b.classList.toggle('on',b.dataset.r===r));
  renderGrid();
};
function renderGrid(){
  const grid=document.getElementById('heroGrid');
  const none=document.getElementById('noHero');
  let list=LIB.filter(h=>CTRS.some(c=>c.heroId===h.id));
  if(role!=='all') list=list.filter(h=>h.role===role);
  if(!list.length){ grid.style.display='none'; none.style.display='block'; return; }
  grid.style.display='grid'; none.style.display='none';
  grid.innerHTML='';
  list.forEach(h=>{
    const cd=CTRS.find(c=>c.heroId===h.id);
    const cnt=cd&&cd.counters?cd.counters.length:0;
    const el=document.createElement('div');
    el.className='hero-card'; el.dataset.id=h.id;
    el.innerHTML=`<div class="hero-card-img">
      ${h.image?`<img src="${h.image}" alt="${esc(h.name)}" loading="lazy">`:`<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:3rem">â“</div>`}
      ${h.role?`<div class="hero-card-role">${esc(h.role)}</div>`:''}
      ${cnt>0?`<div class="hero-card-badge">${cnt}</div>`:''}
      <div class="hero-card-name">${esc(h.name)}</div>
    </div>`;
    el.onclick=()=>openDetail(h.id);
    grid.appendChild(el);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDetail(id){
  viewId=id;
  const h=LIB.find(x=>x.id===id); if(!h) return;
  const cd=CTRS.find(c=>c.heroId===id);
  document.getElementById('dtTitle').textContent=h.name;
  document.getElementById('dtName').textContent=h.name;
  document.getElementById('dtImg').innerHTML=h.image
    ?`<img src="${h.image}" alt="${esc(h.name)}">`
    :`<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:3.5rem">â“</div>`;
  const tags=document.getElementById('dtTags');
  tags.innerHTML='';
  if(h.role) tags.innerHTML+=`<div class="tag">ğŸ“ ${esc(h.role)}</div>`;
  if(h.lane) tags.innerHTML+=`<div class="tag">ğŸ›£ï¸ ${esc(h.lane)}</div>`;
  const cs=document.getElementById('dtCounterSec');
  if(cd&&cd.counters&&cd.counters.length){
    cs.style.display='block';
    document.getElementById('dtCounterGrid').innerHTML=cd.counters.map(cid=>{
      const ch=LIB.find(x=>x.id===cid); if(!ch) return '';
      return `<div class="c-card"><div class="c-card-img">${ch.image?`<img src="${ch.image}" alt="${esc(ch.name)}">`:`<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:2rem">â“</div>`}</div><div class="c-card-name">${esc(ch.name)}</div></div>`;
    }).join('');
  } else { cs.style.display='none'; }
  const ns=document.getElementById('dtNotesSec');
  if(cd&&cd.notes&&cd.notes.trim()){ ns.style.display='block'; document.getElementById('dtNotesBox').textContent=cd.notes; }
  else { ns.style.display='none'; }
  openModal('detailModal');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDIT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.openEditModal=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  if(!viewId) return;
  editId=viewId;
  const h=LIB.find(x=>x.id===editId);
  const cd=CTRS.find(c=>c.heroId===editId);
  picked=cd&&cd.counters?[...cd.counters]:[];
  document.getElementById('editNotes').value=cd&&cd.notes?cd.notes:'';
  const th=document.getElementById('editThumb');
  th.innerHTML=h&&h.image?`<img src="${h.image}" alt="">`:`<div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.2rem">âš”ï¸</div>`;
  document.getElementById('editTitle').textContent=h?`à¹à¸à¹‰à¹„à¸‚: ${h.name}`:'à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ';
  document.getElementById('pickerSearch').value='';
  renderPicker(); renderPickedList();
  closeModal('detailModal'); openModal('editModal');
};

function renderPicker(){
  const term=document.getElementById('pickerSearch').value.trim().toLowerCase();
  const grid=document.getElementById('pickerGrid');
  const list=LIB.filter(h=>h.id!==editId&&(!term||h.name.toLowerCase().includes(term)));
  if(!list.length){ grid.innerHTML=`<div class="picker-empty">à¹„à¸¡à¹ˆà¸à¸šà¸®à¸µà¹‚à¸£à¹ˆà¸—à¸µà¹ˆà¸„à¹‰à¸™à¸«à¸²</div>`; return; }
  grid.innerHTML='';
  list.forEach(h=>{
    const el=document.createElement('div');
    el.className='picker-item'+(picked.includes(h.id)?' picked':'');
    el.dataset.hid=h.id; el.title=h.name;
    el.innerHTML=`<div class="picker-item-img">${h.image?`<img src="${h.image}" alt="${esc(h.name)}" loading="lazy">`:`<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:1.6rem">â“</div>`}</div><div class="picker-item-name">${esc(h.name)}</div>`;
    el.addEventListener('click',()=>{ const idx=picked.indexOf(h.id); if(idx>-1){ picked.splice(idx,1); el.classList.remove('picked'); } else { picked.push(h.id); el.classList.add('picked'); } renderPickedList(); });
    grid.appendChild(el);
  });
}

function renderPickedList(){
  const wrap=document.getElementById('pickedList');
  if(!picked.length){ wrap.innerHTML='<span class="picked-empty">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œ</span>'; return; }
  wrap.innerHTML=picked.map(hid=>{ const h=LIB.find(x=>x.id===hid); if(!h) return '';
    return `<span class="picked-tag">${h.image?`<img src="${h.image}" alt="">`:''}${esc(h.name)}<button class="picked-tag-rm" data-rm="${hid}">Ã—</button></span>`;
  }).join('');
  wrap.querySelectorAll('[data-rm]').forEach(btn=>{
    btn.addEventListener('click',e=>{ e.stopPropagation(); const hid=btn.dataset.rm; picked=picked.filter(x=>x!==hid);
      const pi=document.querySelector(`.picker-item[data-hid="${hid}"]`); if(pi) pi.classList.remove('picked');
      renderPickedList(); });
  });
}

window.saveEdit=async()=>{
  if(!editId){ toast('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”','err'); return; }
  const ctr={heroId:editId, counters:[...picked], notes:document.getElementById('editNotes').value.trim()};
  setSyncStatus('loading','à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...');
  try{
    await saveCtr(ctr);
    setSyncStatus('ok', useFirebase?'à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¸‡ Firebase à¹à¸¥à¹‰à¸§ âœ“':'à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§ âœ“');
    closeModal('editModal'); toast('à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ âœ…','ok');
    viewId=editId; openDetail(editId);
  }catch(e){ setSyncStatus('err','à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ'); toast('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: '+e.message,'err'); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DELETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.doDeleteCounter=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  const h=LIB.find(x=>x.id===viewId);
  confirm2('ğŸ—‘ï¸',`à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œà¸‚à¸­à¸‡ "${h?h.name:'à¸®à¸µà¹‚à¸£à¹ˆà¸™à¸µà¹‰'}" à¸­à¸­à¸à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`,async()=>{
    try{ await deleteCtr(viewId); closeModal('detailModal'); viewId=null; toast('à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ','ok'); }
    catch(e){ toast('à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
  });
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIBRARY MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.openAddHero=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  libSel=[]; document.getElementById('libSearch').value='';
  renderLibGrid(); switchLibTab('sel'); openModal('libModal');
};

window.switchLibTab=(t)=>{
  document.getElementById('libTabSel').classList.toggle('on',t==='sel');
  document.getElementById('libTabAdd').classList.toggle('on',t==='add');
  document.getElementById('libSelPane').style.display=t==='sel'?'block':'none';
  document.getElementById('libAddPane').style.display=t==='add'?'block':'none';
};

function renderLibGrid(){
  const term=document.getElementById('libSearch').value.trim().toLowerCase();
  const grid=document.getElementById('libGrid');
  const list=LIB.filter(h=>!term||h.name.toLowerCase().includes(term));
  grid.innerHTML='';
  list.forEach(h=>{
    const el=document.createElement('div');
    el.className='lib-item'+(libSel.includes(h.id)?' lib-selected':'');
    el.dataset.hid=h.id;
    el.innerHTML=`<div class="lib-item-inner">${h.image?`<img src="${h.image}" alt="${esc(h.name)}" loading="lazy">`:`<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:2rem">â“</div>`}</div><div class="lib-item-name">${esc(h.name)}</div>${!locked?`<button class="lib-item-del">Ã—</button>`:''}`;
    el.addEventListener('click',()=>{ const idx=libSel.indexOf(h.id); if(idx>-1){ libSel.splice(idx,1); el.classList.remove('lib-selected'); } else { libSel.push(h.id); el.classList.add('lib-selected'); } document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`; });
    const delBtn=el.querySelector('.lib-item-del');
    if(delBtn) delBtn.addEventListener('click',e=>{ e.stopPropagation(); doDelFromLib(h.id); });
    grid.appendChild(el);
  });
  document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`;
}

window.confirmLibSel=async()=>{
  if(!libSel.length){ toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸•à¸±à¸§','err'); return; }
  let added=0;
  for(const hid of libSel){
    if(!CTRS.find(c=>c.heroId===hid)){
      await saveCtr({heroId:hid,counters:[],notes:''});
      added++;
    }
  }
  closeModal('libModal'); renderGrid();
  if(libSel.length===1){
    viewId=libSel[0]; editId=libSel[0];
    const h=LIB.find(x=>x.id===editId);
    const cd=CTRS.find(c=>c.heroId===editId);
    picked=cd&&cd.counters?[...cd.counters]:[];
    document.getElementById('editNotes').value=cd&&cd.notes?cd.notes:'';
    const th=document.getElementById('editThumb');
    th.innerHTML=h&&h.image?`<img src="${h.image}" alt="">`:`<div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.2rem">âš”ï¸</div>`;
    document.getElementById('editTitle').textContent=h?`à¹à¸à¹‰à¹„à¸‚: ${h.name}`:'à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ';
    document.getElementById('pickerSearch').value='';
    renderPicker(); renderPickedList(); openModal('editModal');
  }
  toast(added?`à¹€à¸à¸´à¹ˆà¸¡ ${added} à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§`:'à¸®à¸µà¹‚à¸£à¹ˆà¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸¡à¸µà¹ƒà¸™à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§','ok');
};

function doDelFromLib(hid){
  if(locked) return;
  const h=LIB.find(x=>x.id===hid);
  confirm2('ğŸ—‘ï¸',`à¸¥à¸š "${h?h.name:'à¸®à¸µà¹‚à¸£à¹ˆà¸™à¸µà¹‰'}" à¸­à¸­à¸à¸ˆà¸²à¸à¸„à¸¥à¸±à¸‡?`,async()=>{
    try{
      await deleteLibHero(hid);
      libSel=libSel.filter(x=>x!==hid);
      picked=picked.filter(x=>x!==hid);
      if(!useFirebase){ renderLibGrid(); renderGrid(); }
      if(document.getElementById('editModal').classList.contains('show')){ renderPicker(); renderPickedList(); }
      toast('à¸¥à¸šà¸®à¸µà¹‚à¸£à¹ˆà¸­à¸­à¸à¸ˆà¸²à¸à¸„à¸¥à¸±à¸‡à¹à¸¥à¹‰à¸§','ok');
    }catch(e){ toast('à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
  });
}

window.addHeroToLib=async()=>{
  const name=document.getElementById('qName').value.trim();
  if(!name){ toast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸®à¸µà¹‚à¸£à¹ˆ','err'); return; }
  if(LIB.some(h=>h.name.toLowerCase()===name.toLowerCase())){ toast('à¸®à¸µà¹‚à¸£à¹ˆà¸Šà¸·à¹ˆà¸­à¸™à¸µà¹‰à¸¡à¸µà¹ƒà¸™à¸„à¸¥à¸±à¸‡à¹à¸¥à¹‰à¸§','err'); return; }
  const url=document.getElementById('qUrl').value.trim();
  const hero={ id:Date.now().toString(), name, image:pendImg||url||'', role:document.getElementById('qRole').value, lane:'' };
  try{
    await saveLib(hero);
    document.getElementById('qName').value='';
    document.getElementById('qRole').value='';
    document.getElementById('qUrl').value='';
    document.getElementById('qFile').value='';
    pendImg='';
    const z=document.getElementById('qUpload');
    z.classList.remove('has-img'); z.innerHTML='<span>ğŸ“ à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸ à¸²à¸</span>';
    if(!useFirebase) renderLibGrid();
    if(document.getElementById('editModal').classList.contains('show')) renderPicker();
    toast(`à¹€à¸à¸´à¹ˆà¸¡ "${name}" à¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ`,'ok');
  }catch(e){ toast('à¹€à¸à¸´à¹ˆà¸¡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(msg,type='ok'){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  t.innerHTML=`<span>${type==='ok'?'âœ…':type==='info'?'â„¹ï¸':'âŒ'}</span><span>${esc(msg)}</span>`;
  document.body.appendChild(t); setTimeout(()=>t.remove(),3500);
}
function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

init();
</script>

</body>
</html>