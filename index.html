<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROV Hero Counter Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --bg0:#04080f;--bg1:#080e1a;--bg2:#0d1424;--bg3:#131d32;--bg4:#1a2540;
  --txt:#dce4f5;--txt2:#7a8db0;--txt3:#3d5070;
  --gold:#f0b429;--gold2:#d4930a;
  --blue:#4f6ef7;--blue2:#3a54e0;--blue-glow:rgba(79,110,247,.35);
  --green:#00e87a;--green2:#00b85e;--green-glow:rgba(0,232,122,.3);
  --red:#f04060;--red2:#c0283c;--red-glow:rgba(240,64,96,.3);
  --purple:#9b5de5;--cyan:#00d4ff;
  --bdr:rgba(255,255,255,0.07);--bdr2:rgba(255,255,255,0.12);
  --r8:8px;--r12:12px;--r16:16px;--r24:24px;
  --shadow-sm:0 2px 8px rgba(0,0,0,.4);
  --shadow-md:0 4px 20px rgba(0,0,0,.5);
  --shadow-lg:0 8px 40px rgba(0,0,0,.65);
}

body{
font-family:â€˜Kanitâ€™,sans-serif;
background:var(â€“bg0);color:var(â€“txt);
min-height:100vh;overflow-x:hidden;
}

/* animated bg mesh */
body::before{
content:â€™â€™;position:fixed;inset:0;z-index:0;pointer-events:none;
background:
radial-gradient(ellipse 80% 60% at 10% 20%,rgba(79,110,247,.12) 0%,transparent 60%),
radial-gradient(ellipse 60% 80% at 90% 80%,rgba(0,232,122,.08) 0%,transparent 60%),
radial-gradient(ellipse 50% 40% at 50% 50%,rgba(155,93,229,.05) 0%,transparent 70%);
animation:meshMove 12s ease-in-out infinite alternate;
}
@keyframes meshMove{
from{background-position:0% 0%,100% 100%,50% 50%}
to{background-position:5% 8%,95% 92%,52% 48%}
}

/* scanline texture */
body::after{
content:â€™â€™;position:fixed;inset:0;z-index:0;pointer-events:none;
background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px);
opacity:.5;
}

img{display:block;width:100%;height:100%;object-fit:cover}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(â€“bg1)}
::-webkit-scrollbar-thumb{background:var(â€“blue);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(â€“blue2)}

/* â”€â”€ active/press effects for ALL interactive elements â”€â”€ */
button:active,
.hero-card:active,
.picker-item:active,
.lib-item:active,
.role-btn:active{
transform:scale(.94)!important;
filter:brightness(.85);
transition:transform .08s,filter .08s!important;
}
#fab:active{transform:scale(.9) rotate(45deg)!important}
#lockBtn:active{transform:scale(.88)!important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap{max-width:1440px;margin:0 auto;padding:24px 20px;position:relative;z-index:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr{text-align:center;padding:36px 20px 20px;margin-bottom:28px;position:relative}
.hdr-eyebrow{
font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.25em;font-size:.72rem;
color:var(â€“gold);text-transform:uppercase;margin-bottom:10px;
display:flex;align-items:center;justify-content:center;gap:12px;
}
.hdr-eyebrow::before,.hdr-eyebrow::after{
content:â€™â€™;flex:1;max-width:80px;height:1px;
background:linear-gradient(90deg,transparent,var(â€“gold));
}
.hdr-eyebrow::after{background:linear-gradient(90deg,var(â€“gold),transparent)}
.hdr h1{
font-family:â€˜Rajdhaniâ€™,sans-serif;
font-size:clamp(2rem,5vw,3.2rem);font-weight:700;letter-spacing:.04em;
background:linear-gradient(135deg,#fff 0%,var(â€“gold) 40%,var(â€“blue) 100%);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
line-height:1.1;margin-bottom:10px;
}
.hdr-sub{color:var(â€“txt2);font-size:.9rem;letter-spacing:.02em}

/* â”€â”€ LOCK BTN â”€â”€ */
#lockBtn{
position:fixed;top:20px;right:20px;
width:44px;height:44px;
background:linear-gradient(135deg,var(â€“bg3),var(â€“bg2));
border:1.5px solid var(â€“bdr2);border-radius:50%;
display:flex;align-items:center;justify-content:center;
cursor:pointer;z-index:9999;font-size:1.2rem;
box-shadow:var(â€“shadow-md);
transition:all .2s;
}
#lockBtn:hover{border-color:var(â€“blue);box-shadow:0 0 20px var(â€“blue-glow);transform:scale(1.08)}
#lockBtn.open{border-color:var(â€“green);box-shadow:0 0 20px var(â€“green-glow)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ROLE FILTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.roles{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:28px}
.role-btn{
padding:9px 18px;
background:linear-gradient(135deg,var(â€“bg3),var(â€“bg2));
border:1.5px solid var(â€“bdr);border-radius:var(â€“r8);
color:var(â€“txt2);font-family:â€˜Rajdhaniâ€™,sans-serif;
font-size:.9rem;font-weight:600;letter-spacing:.05em;
cursor:pointer;transition:all .2s;position:relative;overflow:hidden;
}
.role-btn::before{
content:â€™â€™;position:absolute;inset:0;
background:linear-gradient(135deg,var(â€“blue),var(â€“purple));
opacity:0;transition:opacity .2s;
}
.role-btn:hover{border-color:var(â€“blue);color:#fff;transform:translateY(-2px);box-shadow:0 4px 16px var(â€“blue-glow)}
.role-btn:hover::before{opacity:.15}
.role-btn.on{
background:linear-gradient(135deg,var(â€“blue),var(â€“blue2));
border-color:var(â€“blue);color:#fff;
box-shadow:0 0 20px var(â€“blue-glow),0 4px 12px rgba(0,0,0,.3);
transform:translateY(-2px);
}
.role-btn span{position:relative;z-index:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HERO GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-grid{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:16px;margin-bottom:32px;
animation:fadeUp .5s ease both;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

.hero-card{
aspect-ratio:3/4;
background:var(â€“bg2);
border-radius:var(â€“r12);overflow:hidden;
cursor:pointer;position:relative;
border:1.5px solid var(â€“bdr);
transition:transform .25s cubic-bezier(.34,1.56,.64,1),box-shadow .25s,border-color .25s;
box-shadow:var(â€“shadow-sm);
}
.hero-card::before{
content:â€™â€™;position:absolute;inset:0;z-index:1;
background:linear-gradient(to top,rgba(0,0,0,.92) 0%,rgba(0,0,0,.3) 45%,transparent 100%);
pointer-events:none;
}
.hero-card:hover{
transform:translateY(-8px) scale(1.03);
box-shadow:0 12px 36px rgba(0,0,0,.5),0 0 0 1.5px var(â€“gold);
border-color:var(â€“gold);z-index:5;
}
.hero-card-img{width:100%;height:100%;position:absolute;inset:0}
.hero-card-placeholder{
width:100%;height:100%;position:absolute;inset:0;
display:flex;align-items:center;justify-content:center;
font-size:3.5rem;background:var(â€“bg3);
}
.hero-card-name{
position:absolute;bottom:0;left:0;right:0;z-index:2;
padding:20px 10px 10px;
text-align:center;font-family:â€˜Rajdhaniâ€™,sans-serif;
font-size:.9rem;font-weight:700;letter-spacing:.04em;color:#fff;
text-shadow:0 1px 4px rgba(0,0,0,.8);
}
.hero-card-badge{
position:absolute;top:8px;right:8px;z-index:2;
background:linear-gradient(135deg,var(â€“gold),var(â€“gold2));
color:#000;font-size:.65rem;font-weight:700;
padding:3px 8px;border-radius:10px;letter-spacing:.05em;
font-family:â€˜Rajdhaniâ€™,sans-serif;
box-shadow:0 2px 8px rgba(0,0,0,.4);
}
.hero-card-role{
position:absolute;top:8px;left:8px;z-index:2;
background:rgba(0,0,0,.7);backdrop-filter:blur(8px);
font-size:.62rem;font-weight:600;padding:3px 8px;
border-radius:5px;border:1px solid var(â€“bdr2);
color:var(â€“txt2);font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.05em;
}
.no-hero{
text-align:center;padding:80px 20px;color:var(â€“txt3);
animation:fadeUp .5s ease;
}
.no-hero .ico{font-size:5rem;opacity:.25;margin-bottom:18px;display:block}
.no-hero p{font-size:.95rem;line-height:1.8}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MODAL BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg{
position:fixed;inset:0;
background:rgba(0,0,0,.88);backdrop-filter:blur(12px);
display:none;align-items:center;justify-content:center;
padding:16px;
}
.modal-bg.show{display:flex}
#detailModal{z-index:2100}
#editModal{z-index:2200}
#libModal{z-index:2300}
#lockOverlay,#cfmOverlay{z-index:2400}

.modal-box{
background:linear-gradient(160deg,var(â€“bg2) 0%,var(â€“bg1) 100%);
border-radius:var(â€“r16);
border:1px solid var(â€“bdr2);
box-shadow:var(â€“shadow-lg),0 0 0 1px rgba(255,255,255,.03);
width:100%;
animation:modalIn .3s cubic-bezier(.34,1.36,.64,1) both;
}
@keyframes modalIn{from{opacity:0;transform:scale(.9) translateY(24px)}to{opacity:1;transform:none}}
.modal-hdr{
padding:20px 24px;
background:linear-gradient(135deg,var(â€“bg3) 0%,var(â€“bg2) 100%);
border-bottom:1px solid var(â€“bdr);
border-radius:var(â€“r16) var(â€“r16) 0 0;
display:flex;align-items:center;gap:12px;
}
.modal-hdr h2{font-size:1.2rem;font-weight:700;flex:1;font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.04em}
.modal-close{
width:34px;height:34px;flex-shrink:0;
background:rgba(255,255,255,.06);border:1px solid var(â€“bdr);
border-radius:50%;color:var(â€“txt2);font-size:1.2rem;
cursor:pointer;display:flex;align-items:center;justify-content:center;
transition:all .2s;line-height:1;
}
.modal-close:hover{background:var(â€“red);border-color:var(â€“red);color:#fff;transform:rotate(90deg)!important;filter:none!important}
.modal-body{padding:22px 24px;overflow-y:auto}
.modal-ftr{
padding:14px 24px;
background:rgba(0,0,0,.2);
border-top:1px solid var(â€“bdr);
border-radius:0 0 var(â€“r16) var(â€“r16);
display:flex;align-items:center;justify-content:space-between;gap:10px;flex-shrink:0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#detailModal .modal-box{max-width:820px;max-height:90vh;display:flex;flex-direction:column}
.detail-hero-row{display:flex;gap:22px;align-items:flex-start}
.detail-img{
width:120px;height:150px;flex-shrink:0;
border-radius:var(â€“r12);overflow:hidden;
border:2px solid var(â€“blue);
box-shadow:0 0 28px var(â€“blue-glow),var(â€“shadow-md);
position:relative;
}
.detail-img img{width:100%;height:100%;object-fit:cover}
.detail-info{flex:1;min-width:0}
.detail-info h2{
font-family:â€˜Rajdhaniâ€™,sans-serif;font-size:2rem;font-weight:700;
letter-spacing:.04em;line-height:1;margin-bottom:10px;
background:linear-gradient(135deg,#fff 0%,var(â€“gold) 60%);
-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.detail-tags{display:flex;gap:7px;flex-wrap:wrap}
.tag{
padding:5px 12px;
background:linear-gradient(135deg,var(â€“bg3),var(â€“bg4));
border-radius:20px;font-size:.78rem;color:var(â€“txt2);
border:1px solid var(â€“bdr2);
font-family:â€˜Rajdhaniâ€™,sans-serif;font-weight:600;letter-spacing:.05em;
}
.detail-section{margin-top:20px}
.detail-section h3{
font-family:â€˜Rajdhaniâ€™,sans-serif;font-size:1rem;font-weight:700;
color:var(â€“gold);margin-bottom:12px;letter-spacing:.08em;
text-transform:uppercase;display:flex;align-items:center;gap:8px;
}
.detail-section h3::after{content:â€™â€™;flex:1;height:1px;background:linear-gradient(90deg,var(â€“gold),transparent);opacity:.4}
.c-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px}
.c-card{
background:var(â€“bg3);border-radius:var(â€“r12);overflow:hidden;
border:1px solid var(â€“bdr);
transition:transform .2s,border-color .2s;
}
.c-card:hover{transform:scale(1.06);border-color:var(â€“gold)}
.c-card-img{aspect-ratio:1;background:var(â€“bg2);overflow:hidden}
.c-card-name{
padding:6px 4px;text-align:center;
font-size:.72rem;font-weight:600;color:var(â€“txt2);
font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.03em;
}
.notes-box{
background:var(â€“bg3);border-radius:var(â€“r12);padding:16px;
border:1px solid var(â€“bdr);color:var(â€“txt2);
line-height:1.8;white-space:pre-wrap;font-size:.88rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EDIT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#editModal .modal-box{max-width:680px;max-height:92vh;display:flex;flex-direction:column}
.edit-thumb{
width:42px;height:42px;border-radius:10px;overflow:hidden;
border:2px solid var(â€“blue);flex-shrink:0;
box-shadow:0 0 12px var(â€“blue-glow);
}
.form-lbl{
font-size:.82rem;font-weight:600;margin-bottom:8px;display:block;
color:var(â€“txt2);font-family:â€˜Rajdhaniâ€™,sans-serif;
letter-spacing:.06em;text-transform:uppercase;
}
.form-grp{margin-bottom:20px}
.form-ta{
width:100%;min-height:100px;padding:12px;
background:var(â€“bg3);border:1.5px solid var(â€“bdr);
border-radius:var(â€“r12);color:var(â€“txt);
font-family:â€˜Kanitâ€™,sans-serif;font-size:.9rem;resize:vertical;
transition:border-color .2s;
}
.form-ta:focus{outline:none;border-color:var(â€“blue);box-shadow:0 0 0 3px rgba(79,110,247,.15)}
.form-ta::placeholder{color:var(â€“txt3)}

/* â”€â”€ COUNTER PICKER â”€â”€ */
.picker-wrap{
background:var(â€“bg3);
border:1.5px solid var(â€“bdr);border-radius:var(â€“r12);
overflow:hidden;
}
.picker-search-inp{
width:100%;padding:11px 14px;
background:var(â€“bg2);border:none;border-bottom:1.5px solid var(â€“bdr);
color:var(â€“txt);font-family:â€˜Kanitâ€™,sans-serif;font-size:.88rem;
transition:background .2s;
}
.picker-search-inp:focus{outline:none;background:var(â€“bg1)}
.picker-search-inp::placeholder{color:var(â€“txt3)}
.picker-grid{
display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
gap:8px;padding:12px;max-height:260px;overflow-y:auto;
}
.picker-item{
aspect-ratio:3/4;
background:var(â€“bg2);border-radius:var(â€“r8);
overflow:hidden;cursor:pointer;position:relative;
border:2px solid transparent;
transition:border-color .15s,box-shadow .15s,transform .15s;
user-select:none;
}
/* â”€â”€ hover state â”€â”€ */
.picker-item:hover{
border-color:rgba(79,110,247,.6)!important;
transform:scale(1.06)!important;
z-index:2;
}
/* â”€â”€ SELECTED state â”€â”€ bright green glow + overlay â”€â”€ */
.picker-item.picked{
border-color:var(â€“green)!important;
box-shadow:0 0 0 2px var(â€“green),0 0 16px var(â€“green-glow)!important;
}
.picker-item.picked .picker-item-img::after{
content:â€™â€™;position:absolute;inset:0;
background:rgba(0,232,122,.18);
pointer-events:none;
}
/* â”€â”€ checkmark badge â”€â”€ */
.picker-item.picked .picker-ck{display:flex}
.picker-ck{
display:none;
position:absolute;bottom:22px;right:3px;z-index:3;
width:18px;height:18px;
background:var(â€“green);border-radius:50%;
align-items:center;justify-content:center;
font-size:.65rem;color:#000;font-weight:900;
box-shadow:0 2px 6px rgba(0,0,0,.4);
pointer-events:none;
}
.picker-item-img{width:100%;height:calc(100% - 22px);position:relative;overflow:hidden}
.picker-item-img img{width:100%;height:100%;object-fit:cover}
.picker-item-ph{
width:100%;height:100%;display:flex;align-items:center;
justify-content:center;font-size:1.6rem;background:var(â€“bg3);
}
.picker-item-name{
font-size:.64rem;font-weight:700;text-align:center;
padding:3px 2px;color:var(â€“txt2);
white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.03em;
position:relative;z-index:1;
}
.picker-empty{
padding:28px;text-align:center;color:var(â€“txt3);
font-size:.85rem;grid-column:1/-1;
}

/* â”€â”€ PICKED TAGS â”€â”€ */
.picked-list{display:flex;flex-wrap:wrap;gap:7px;margin-top:10px;min-height:20px}
.picked-tag{
padding:5px 11px;
background:rgba(0,232,122,.08);
border:1.5px solid var(â€“green);border-radius:20px;
font-size:.78rem;color:var(â€“green);
display:inline-flex;align-items:center;gap:6px;
animation:tagIn .2s ease;
}
@keyframes tagIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.picked-tag img{width:20px;height:20px;border-radius:4px;flex-shrink:0;object-fit:cover}
.picked-tag-rm{
cursor:pointer;color:rgba(0,232,122,.45);
font-size:1.1rem;line-height:1;padding:0 2px;
border:none;background:none;font-family:inherit;
transition:color .15s;
}
.picked-tag-rm:hover{color:var(â€“red)!important;transform:none!important;filter:none!important}
.picked-empty{color:var(â€“txt3);font-size:.82rem;padding:2px 0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LIBRARY MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#libModal .modal-box{max-width:1080px;max-height:90vh;display:flex;flex-direction:column}
.lib-tabs{
display:flex;background:var(â€“bg2);
border-bottom:2px solid var(â€“bdr);flex-shrink:0;
}
.lib-tab{
padding:13px 22px;background:transparent;border:none;
color:var(â€“txt2);font-family:â€˜Rajdhaniâ€™,sans-serif;
font-weight:700;cursor:pointer;
border-bottom:3px solid transparent;margin-bottom:-2px;
transition:all .2s;font-size:.9rem;letter-spacing:.05em;
}
.lib-tab:hover{color:var(â€“blue)}
.lib-tab.on{color:var(â€“blue);border-bottom-color:var(â€“blue)}
.lib-body{flex:1;overflow-y:auto;padding:18px 22px}
.lib-search{
width:100%;padding:10px 14px;
background:var(â€“bg3);border:1.5px solid var(â€“bdr);
border-radius:var(â€“r8);color:var(â€“txt);
font-family:â€˜Kanitâ€™,sans-serif;font-size:.88rem;margin-bottom:14px;
transition:border-color .2s;
}
.lib-search:focus{outline:none;border-color:var(â€“blue)}
.lib-search::placeholder{color:var(â€“txt3)}
.lib-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:10px}

/* â”€â”€ lib-item: same logic as picker-item â”€â”€ */
.lib-item{
aspect-ratio:3/4;background:var(â€“bg3);border-radius:var(â€“r8);
overflow:hidden;position:relative;
border:2px solid var(â€“bdr);
transition:border-color .15s,box-shadow .15s,transform .18s;
cursor:pointer;
}
.lib-item:hover{border-color:rgba(79,110,247,.5)!important;transform:scale(1.05)!important}
/* â”€â”€ SELECTED: à¸à¸£à¸­à¸šà¹€à¸‚à¸µà¸¢à¸§ + glow + overlay â”€â”€ */
.lib-item.lib-selected{
border-color:var(â€“green)!important;
box-shadow:0 0 0 2px var(â€“green),0 0 18px var(â€“green-glow)!important;
}
.lib-item.lib-selected .lib-item-inner::after{
content:â€™â€™;position:absolute;inset:0;
background:rgba(0,232,122,.15);pointer-events:none;
}
.lib-item.lib-selected .lib-ck{display:flex}
.lib-ck{
display:none;
position:absolute;bottom:23px;right:4px;z-index:3;
width:18px;height:18px;
background:var(â€“green);border-radius:50%;
align-items:center;justify-content:center;
font-size:.65rem;color:#000;font-weight:900;
pointer-events:none;box-shadow:0 2px 6px rgba(0,0,0,.4);
}
.lib-item-inner{width:100%;height:calc(100% - 24px);position:relative;overflow:hidden}
.lib-item-inner img{width:100%;height:100%;object-fit:cover}
.lib-item-ph{
width:100%;height:100%;display:flex;
align-items:center;justify-content:center;font-size:2rem;
}
.lib-item-name{
font-size:.7rem;font-weight:700;text-align:center;
padding:4px 3px;color:var(â€“txt2);
white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
font-family:â€˜Rajdhaniâ€™,sans-serif;letter-spacing:.03em;
position:relative;z-index:1;
}
.lib-item-del{
position:absolute;top:4px;right:4px;z-index:4;
width:22px;height:22px;
background:var(â€“red);border:none;border-radius:50%;
color:#fff;font-size:.85rem;cursor:pointer;
display:none;align-items:center;justify-content:center;
box-shadow:0 2px 6px rgba(0,0,0,.5);line-height:1;padding:0;
}
.lib-item:hover .lib-item-del{display:flex}
.read-mode .lib-item-del{display:none!important}

/* quick add form */
.qadd-form{
background:linear-gradient(135deg,var(â€“bg3),var(â€“bg2));
border-radius:var(â€“r12);padding:20px;
border:1.5px dashed var(â€“bdr2);
}
.qadd-title{
font-family:â€˜Rajdhaniâ€™,sans-serif;font-size:1rem;font-weight:700;
color:var(â€“blue);margin-bottom:14px;letter-spacing:.05em;
}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.f-inp,.f-sel{
width:100%;padding:9px 12px;
background:var(â€“bg2);border:1.5px solid var(â€“bdr);
border-radius:var(â€“r8);color:var(â€“txt);
font-family:â€˜Kanitâ€™,sans-serif;font-size:.85rem;
transition:border-color .2s;
}
.f-inp:focus,.f-sel:focus{outline:none;border-color:var(â€“blue);box-shadow:0 0 0 2px rgba(79,110,247,.15)}
.f-inp::placeholder{color:var(â€“txt3)}
.f-sel option{background:var(â€“bg2)}
.upload-zone{
border:2px dashed var(â€“bdr2);border-radius:var(â€“r8);
padding:18px;text-align:center;cursor:pointer;
transition:all .2s;display:flex;align-items:center;
justify-content:center;min-height:62px;margin-bottom:10px;
color:var(â€“txt2);font-size:.85rem;
}
.upload-zone:hover{border-color:var(â€“blue);background:rgba(79,110,247,.06);color:var(â€“blue)}
.upload-zone.has-img{padding:4px}
.upload-preview{width:100%;max-height:130px;object-fit:contain;border-radius:var(â€“r8)}
.btn-qadd{
width:100%;padding:11px;
background:linear-gradient(135deg,var(â€“blue),var(â€“blue2));
color:#fff;border:none;border-radius:var(â€“r8);
font-family:â€˜Rajdhaniâ€™,sans-serif;font-weight:700;
cursor:pointer;transition:all .2s;font-size:.95rem;
letter-spacing:.05em;box-shadow:0 4px 12px var(â€“blue-glow);
}
.btn-qadd:hover{transform:translateY(-2px);box-shadow:0 6px 18px var(â€“blue-glow)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
padding:9px 20px;border-radius:var(â€“r8);
font-family:â€˜Rajdhaniâ€™,sans-serif;font-weight:700;
cursor:pointer;transition:all .2s;font-size:.9rem;
display:inline-flex;align-items:center;gap:7px;border:none;
letter-spacing:.05em;position:relative;overflow:hidden;
}
.btn::after{
content:â€™â€™;position:absolute;inset:0;
background:rgba(255,255,255,0);transition:background .15s;
}
.btn:hover::after{background:rgba(255,255,255,.08)}

.btn-ghost{
background:transparent;border:1.5px solid var(â€“bdr2);color:var(â€“txt2);
}
.btn-ghost:hover{border-color:var(â€“txt);color:var(â€“txt)}
.btn-primary{
background:linear-gradient(135deg,var(â€“blue),var(â€“blue2));color:#fff;
box-shadow:0 3px 10px var(â€“blue-glow);
}
.btn-primary:hover{box-shadow:0 5px 18px var(â€“blue-glow);transform:translateY(-1px)}
.btn-success{
background:linear-gradient(135deg,var(â€“green),var(â€“green2));color:#000;
box-shadow:0 3px 10px var(â€“green-glow);font-weight:800;
}
.btn-success:hover{box-shadow:0 5px 18px var(â€“green-glow);transform:translateY(-1px)}
.btn-danger{
background:linear-gradient(135deg,var(â€“red),var(â€“red2));color:#fff;
box-shadow:0 3px 10px var(â€“red-glow);
}
.btn-danger:hover{box-shadow:0 5px 18px var(â€“red-glow);transform:translateY(-1px)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#fab{
position:fixed;bottom:28px;right:28px;
width:58px;height:58px;z-index:999;
background:linear-gradient(135deg,var(â€“blue),var(â€“purple));
border-radius:50%;display:flex;align-items:center;justify-content:center;
cursor:pointer;font-size:2rem;color:#fff;
box-shadow:0 4px 20px rgba(79,110,247,.55),0 8px 32px rgba(0,0,0,.3);
transition:all .3s cubic-bezier(.34,1.56,.64,1);
border:2px solid rgba(255,255,255,.15);
}
#fab:hover{transform:scale(1.12) rotate(90deg);box-shadow:0 6px 28px rgba(79,110,247,.7)}
.read-mode #fab{display:none}
.read-mode .admin-only{display:none!important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LOCK / CONFIRM OVERLAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#lockOverlay,#cfmOverlay{
position:fixed;inset:0;
background:rgba(0,0,0,.9);backdrop-filter:blur(12px);
display:none;align-items:center;justify-content:center;
padding:20px;
}
#lockOverlay.show,#cfmOverlay.show{display:flex}
.lock-box,.cfm-box{
background:linear-gradient(160deg,var(â€“bg3),var(â€“bg2));
border-radius:var(â€“r16);padding:38px 32px;max-width:380px;width:100%;
border:1px solid var(â€“bdr2);box-shadow:var(â€“shadow-lg);text-align:center;
animation:modalIn .3s ease;
}
.lock-ico,.cfm-ico-wrap{font-size:3rem;margin-bottom:14px;display:block}
.lock-box h3,.cfm-box h3{
font-family:â€˜Rajdhaniâ€™,sans-serif;font-size:1.4rem;font-weight:700;
margin-bottom:8px;letter-spacing:.04em;
}
.lock-box p{color:var(â€“txt2);font-size:.88rem;margin-bottom:18px;line-height:1.6}
.cfm-msg{color:var(â€“txt2);font-size:.9rem;margin-bottom:22px;line-height:1.6}
.pw-inp{
width:100%;padding:13px;
background:var(â€“bg3);border:1.5px solid var(â€“bdr2);
border-radius:var(â€“r8);color:var(â€“txt);
font-size:1rem;text-align:center;letter-spacing:4px;
margin-bottom:16px;font-family:â€˜Kanitâ€™,sans-serif;
transition:border-color .2s;
}
.pw-inp:focus{outline:none;border-color:var(â€“blue);box-shadow:0 0 0 3px rgba(79,110,247,.2)}
.lock-btns,.cfm-btns{display:flex;gap:10px;justify-content:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SYNC BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#syncBar{
display:none;align-items:center;gap:8px;justify-content:center;
margin-bottom:14px;padding:9px 16px;
background:rgba(240,64,96,.08);border:1px solid rgba(240,64,96,.2);
border-radius:var(â€“r8);font-size:.82rem;color:var(â€“txt2);
}
.sync-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.sync-dot.ok{background:var(â€“green)}
.sync-dot.err{background:var(â€“red)}
.sync-dot.loading{background:var(â€“blue);animation:blink .8s infinite}
@keyframes blink{0%,100%{opacity:.3}50%{opacity:1}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
position:fixed;bottom:28px;left:50%;transform:translateX(-50%);
background:linear-gradient(135deg,var(â€“bg3),var(â€“bg2));
color:var(â€“txt);padding:12px 20px;
border-radius:var(â€“r12);
box-shadow:var(â€“shadow-lg);border:1px solid var(â€“bdr2);
z-index:9999;display:flex;align-items:center;gap:10px;
animation:toastIn .3s cubic-bezier(.34,1.5,.64,1);
white-space:nowrap;font-size:.88rem;font-weight:500;
pointer-events:none;
}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(16px) scale(.9)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}
.toast.ok{border-left:3px solid var(â€“green)}
.toast.err{border-left:3px solid var(â€“red)}
.toast.info{border-left:3px solid var(â€“blue)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:1100px){.hero-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.hero-grid{grid-template-columns:repeat(3,1fr)}.detail-hero-row{flex-direction:column}}
@media(max-width:540px){
.hero-grid{grid-template-columns:repeat(2,1fr)}
.hdr h1{font-size:1.8rem}
.form-row{grid-template-columns:1fr}
.modal-body{padding:16px}
.modal-hdr{padding:16px 18px}
}
</style>

</head>
<body>

<button id="lockBtn" onclick="toggleLock()">ğŸ”’</button>

<div id="fab" onclick="openAddHero()">+</div>

<div class="wrap">
  <div class="hdr">
    <div class="hdr-eyebrow"><span>Realm of Valor</span></div>
    <h1>âš” Hero Counter Guide</h1>
    <p class="hdr-sub">à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œà¹à¸¥à¸°à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œà¸à¸²à¸£à¸•à¹ˆà¸­à¸ªà¸¹à¹‰</p>
  </div>

  <div id="syncBar">
    <div class="sync-dot err" id="syncDot"></div>
    <span id="syncText">à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Firebase à¹„à¸¡à¹ˆà¹„à¸”à¹‰</span>
  </div>
  <div id="setupBanner" style="display:none"></div>

  <div class="roles">
    <button class="role-btn on" data-r="all"      onclick="setRole('all')"><span>ğŸ¯ à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</span></button>
    <button class="role-btn" data-r="Tank"         onclick="setRole('Tank')"><span>ğŸ›¡ï¸ Tank</span></button>
    <button class="role-btn" data-r="Fighter"      onclick="setRole('Fighter')"><span>âš”ï¸ Fighter</span></button>
    <button class="role-btn" data-r="Assassin"     onclick="setRole('Assassin')"><span>ğŸ—¡ï¸ Assassin</span></button>
    <button class="role-btn" data-r="Mage"         onclick="setRole('Mage')"><span>ğŸ”® Mage</span></button>
    <button class="role-btn" data-r="Carry"        onclick="setRole('Carry')"><span>ğŸ¹ Carry</span></button>
    <button class="role-btn" data-r="Support"      onclick="setRole('Support')"><span>ğŸ’š Support</span></button>
  </div>
  <div class="hero-grid" id="heroGrid"></div>
  <div class="no-hero" id="noHero" style="display:none">
    <span class="ico">ğŸ®</span>
    <p>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸™à¸«à¸¡à¸§à¸”à¸™à¸µà¹‰<br>à¸à¸”à¸›à¸¸à¹ˆà¸¡ <strong>+</strong> à¸¡à¸¸à¸¡à¸¥à¹ˆà¸²à¸‡à¸‚à¸§à¸²à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆ</p>
  </div>
</div>

<!-- â•â•â•â• DETAIL MODAL â•â•â•â• -->

<div class="modal-bg" id="detailModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2 id="dtTitle">â€”</h2>
      <button class="modal-close" onclick="closeModal('detailModal')">Ã—</button>
    </div>
    <div class="modal-body" style="flex:1;overflow-y:auto">
      <div class="detail-hero-row">
        <div class="detail-img" id="dtImg"></div>
        <div class="detail-info">
          <h2 id="dtName"></h2>
          <div class="detail-tags" id="dtTags"></div>
        </div>
      </div>
      <div class="detail-section" id="dtCounterSec" style="display:none">
        <h3>ğŸ¯ à¸®à¸µà¹‚à¸£à¹ˆà¹à¸à¹‰à¸—à¸²à¸‡</h3>
        <div class="c-grid" id="dtCounterGrid"></div>
      </div>
      <div class="detail-section" id="dtNotesSec" style="display:none">
        <h3>ğŸ“ à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œ</h3>
        <div class="notes-box" id="dtNotesBox"></div>
      </div>
    </div>
    <div class="modal-ftr">
      <span></span>
      <div class="admin-only" style="display:flex;gap:10px">
        <button class="btn btn-primary" onclick="openEditModal()">âœï¸ à¹à¸à¹‰à¹„à¸‚</button>
        <button class="btn btn-danger"  onclick="doDeleteCounter()">ğŸ—‘ï¸ à¸¥à¸š</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â• EDIT MODAL â•â•â•â• -->

<div class="modal-bg" id="editModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <div class="edit-thumb" id="editThumb">
        <div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.1rem">âš”ï¸</div>
      </div>
      <h2 id="editTitle">à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ</h2>
      <button class="modal-close" onclick="closeModal('editModal')">Ã—</button>
    </div>
    <div class="modal-body" style="flex:1;overflow-y:auto">
      <div class="form-grp">
        <label class="form-lbl">ğŸ¯ à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹à¸à¹‰à¸—à¸²à¸‡ â€” à¸à¸”à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸ / à¸à¸”à¸‹à¹‰à¸³à¹€à¸à¸·à¹ˆà¸­à¸¢à¸à¹€à¸¥à¸´à¸</label>
        <div class="picker-wrap">
          <input class="picker-search-inp" id="pickerSearch" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸®à¸µà¹‚à¸£à¹ˆ..." autocomplete="off">
          <div class="picker-grid" id="pickerGrid"></div>
        </div>
        <div class="picked-list" id="pickedList"></div>
      </div>
      <div class="form-grp">
        <label class="form-lbl">ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ / à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œ</label>
        <textarea class="form-ta" id="editNotes" placeholder="à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ à¹€à¸Šà¹ˆà¸™ à¸ªà¸à¸´à¸¥à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸°à¸§à¸±à¸‡..."></textarea>
      </div>
    </div>
    <div class="modal-ftr">
      <button class="btn btn-ghost" onclick="closeModal('editModal')">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-success" onclick="saveEdit()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸</button>
    </div>
  </div>
</div>

<!-- â•â•â•â• LIBRARY MODAL â•â•â•â• -->

<div class="modal-bg" id="libModal">
  <div class="modal-box">
    <div class="modal-hdr">
      <h2>ğŸ“š à¸„à¸¥à¸±à¸‡à¸®à¸µà¹‚à¸£à¹ˆ</h2>
      <button class="modal-close" onclick="closeModal('libModal')">Ã—</button>
    </div>
    <div class="lib-tabs">
      <button class="lib-tab on" id="libTabSel" onclick="switchLibTab('sel')">ğŸ¯ à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š</button>
      <button class="lib-tab"    id="libTabAdd" onclick="switchLibTab('add')">â• à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</button>
    </div>
    <div class="lib-body">
      <div id="libSelPane">
        <input class="lib-search" id="libSearch" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸®à¸µà¹‚à¸£à¹ˆ..." autocomplete="off">
        <div class="lib-grid" id="libGrid"></div>
      </div>
      <div id="libAddPane" style="display:none">
        <div class="qadd-form">
          <div class="qadd-title">â• à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</div>
          <div class="form-row">
            <input type="text" class="f-inp" id="qName" placeholder="à¸Šà¸·à¹ˆà¸­à¸®à¸µà¹‚à¸£à¹ˆ *">
            <select class="f-sel" id="qRole">
              <option value="">-- à¸›à¸£à¸°à¹€à¸ à¸— --</option>
              <option>Tank</option>
              <option>Fighter</option>
              <option>Assassin</option>
              <option>Mage</option>
              <option>Carry</option>
              <option>Support</option>
            </select>
          </div>
          <input type="file" id="qFile" accept="image/*" style="display:none">
          <label for="qFile" class="upload-zone" id="qUpload">
            <span>ğŸ“ à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸ à¸²à¸</span>
          </label>
          <input type="url" class="f-inp" id="qUrl" placeholder="à¸«à¸£à¸·à¸­à¸§à¸²à¸‡ URL à¸£à¸¹à¸›à¸ à¸²à¸" style="margin-bottom:10px">
          <button class="btn-qadd" onclick="addHeroToLib()">ğŸ’¾ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡</button>
        </div>
      </div>
    </div>
    <div class="modal-ftr">
      <span style="color:var(--txt2);font-size:.85rem;font-family:'Rajdhani',sans-serif;font-weight:600;letter-spacing:.04em" id="libSelCount">à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ 0 à¸®à¸µà¹‚à¸£à¹ˆ</span>
      <div style="display:flex;gap:10px">
        <button class="btn btn-ghost" onclick="closeModal('libModal')">à¸¢à¸à¹€à¸¥à¸´à¸</button>
        <button class="btn btn-success" onclick="confirmLibSel()">âœ“ à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸š</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ LOCK â”€â”€ -->

<div id="lockOverlay">
  <div class="lock-box">
    <span class="lock-ico">ğŸ”</span>
    <h3>à¸›à¹‰à¸­à¸™à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™</h3>
    <p>à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸à¸·à¹ˆà¸­à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¹‚à¸«à¸¡à¸” Admin</p>
    <input type="password" class="pw-inp" id="pwInp" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
    <div class="lock-btns">
      <button class="btn btn-ghost" style="flex:1" onclick="closeLock()">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-primary" style="flex:1" onclick="checkPw()">ğŸ”“ à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸</button>
    </div>
  </div>
</div>

<!-- â”€â”€ CONFIRM â”€â”€ -->

<div id="cfmOverlay">
  <div class="cfm-box">
    <span class="cfm-ico-wrap" id="cfmIco">âš ï¸</span>
    <div class="cfm-msg" id="cfmMsg">à¸¢à¸·à¸™à¸¢à¸±à¸™?</div>
    <div class="cfm-btns">
      <button class="btn btn-ghost" onclick="closeCfm(false)">à¸¢à¸à¹€à¸¥à¸´à¸</button>
      <button class="btn btn-danger" onclick="closeCfm(true)">à¸¢à¸·à¸™à¸¢à¸±à¸™</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Firebase SDK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script type="module">
import { initializeApp }   from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { getFirestore, collection, doc, getDocs, setDoc, deleteDoc, onSnapshot, writeBatch }
                           from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let LIB    = [];
let CTRS   = [];
let role   = 'all';
let viewId = null;
let editId = null;
let picked = [];   // IDs à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹ƒà¸™ counter picker
let libSel = [];   // IDs à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹ƒà¸™ library modal
let pendImg= '';
let cfmCb  = null;
let locked = true;
let fbApp  = null;
let db     = null;
let useFirebase = false;
let unsubLib  = null;
let unsubCtrs = null;
const PW = '090344';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE CONFIG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyDupvulALaqs2Pe1oiF6-9M451f0hT5vws",
  authDomain: "rov-counter-guide.firebaseapp.com",
  projectId: "rov-counter-guide",
  storageBucket: "rov-counter-guide.firebasestorage.app",
  messagingSenderId: "462634926139",
  appId: "1:462634926139:web:3e9f63d252183295621c1e",
  measurementId: "G-FMZ2V0DVE0"
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function init(){
  await connectFirebase(FIREBASE_CONFIG);
  updateLockUI();

  document.getElementById('pwInp').addEventListener('keypress', e=>{ if(e.key==='Enter') checkPw(); });
  document.getElementById('pickerSearch').addEventListener('input', renderPicker);
  document.getElementById('libSearch').addEventListener('input', renderLibGrid);

  document.getElementById('qFile').addEventListener('change', e=>{
    const f=e.target.files[0]; if(!f) return;
    const rd=new FileReader();
    rd.onload=ev=>{
      pendImg=ev.target.result;
      const z=document.getElementById('qUpload');
      z.classList.add('has-img');
      z.innerHTML=`<img src="${ev.target.result}" class="upload-preview" alt="preview">`;
    };
    rd.readAsDataURL(f);
  });

  ['detailModal','editModal','libModal'].forEach(id=>{
    document.getElementById(id).addEventListener('mousedown', function(e){
      if(e.target===this) closeModal(id);
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function connectFirebase(cfg){
  try{
    if(!fbApp) fbApp=initializeApp(cfg);
    db=getFirestore(fbApp);
    useFirebase=true;
    hideSyncBar();
    subscribeRealtime();
  }catch(e){
    console.warn('Firebase error:',e);
    showSyncError('Firebase à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰ â€” à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡');
    fallbackToLocal();
  }
}

function subscribeRealtime(){
  if(unsubLib)  unsubLib();
  if(unsubCtrs) unsubCtrs();
  unsubLib = onSnapshot(collection(db,'heroLibrary'), snap=>{
    LIB=snap.docs.map(d=>({id:d.id,...d.data()}));
    renderGrid();
    if(document.getElementById('libModal').classList.contains('show')) renderLibGrid();
    if(document.getElementById('editModal').classList.contains('show')) renderPicker();
  });
  unsubCtrs = onSnapshot(collection(db,'heroCounters'), snap=>{
    CTRS=snap.docs.map(d=>({heroId:d.id,...d.data()}));
    renderGrid();
  });
}

function fallbackToLocal(){
  useFirebase=false;
  try{ LIB  = JSON.parse(localStorage.getItem('rovLib') ||'[]') }catch{LIB=[]}
  try{ CTRS = JSON.parse(localStorage.getItem('rovCtrs')||'[]') }catch{CTRS=[]}
  renderGrid();
}

function showSyncError(msg){
  const bar=document.getElementById('syncBar');
  document.getElementById('syncText').textContent=msg;
  bar.style.display='flex';
}
function hideSyncBar(){
  document.getElementById('syncBar').style.display='none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / DELETE HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function saveLib(hero){
  if(useFirebase&&db){
    const {id,...data}=hero;
    await setDoc(doc(db,'heroLibrary',id),data);
  } else {
    const i=LIB.findIndex(h=>h.id===hero.id);
    if(i<0) LIB.push(hero); else LIB[i]=hero;
    localStorage.setItem('rovLib',JSON.stringify(LIB));
    renderGrid(); renderLibGrid();
  }
}

async function saveCtr(ctr){
  if(useFirebase&&db){
    const {heroId,...data}=ctr;
    await setDoc(doc(db,'heroCounters',heroId),data);
  } else {
    let c=CTRS.find(x=>x.heroId===ctr.heroId);
    if(!c){ CTRS.push(ctr); } else Object.assign(c,ctr);
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderGrid();
  }
}

async function deleteLibHero(id){
  if(useFirebase&&db){
    const batch=writeBatch(db);
    batch.delete(doc(db,'heroLibrary',id));
    const snap=await getDocs(collection(db,'heroCounters'));
    snap.docs.forEach(d=>{
      if(d.id===id){ batch.delete(doc(db,'heroCounters',id)); }
      else {
        const arr=(d.data().counters||[]).filter(x=>x!==id);
        if(arr.length!==(d.data().counters||[]).length)
          batch.update(doc(db,'heroCounters',d.id),{counters:arr});
      }
    });
    await batch.commit();
  } else {
    LIB=LIB.filter(h=>h.id!==id);
    CTRS=CTRS.filter(c=>c.heroId!==id);
    CTRS.forEach(c=>{ c.counters=(c.counters||[]).filter(x=>x!==id); });
    localStorage.setItem('rovLib',JSON.stringify(LIB));
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderGrid(); renderLibGrid();
  }
}

async function deleteCtr(heroId){
  if(useFirebase&&db){
    await deleteDoc(doc(db,'heroCounters',heroId));
  } else {
    CTRS=CTRS.filter(c=>c.heroId!==heroId);
    localStorage.setItem('rovCtrs',JSON.stringify(CTRS));
    renderGrid();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateLockUI(){
  const btn=document.getElementById('lockBtn');
  if(locked){
    btn.textContent='ğŸ”’'; btn.classList.remove('open');
    document.body.classList.add('read-mode');
  } else {
    btn.textContent='ğŸ”“'; btn.classList.add('open');
    document.body.classList.remove('read-mode');
  }
}
window.toggleLock=()=>{
  if(locked) openLock();
  else confirm2('ğŸ”’','à¸¥à¹‡à¸­à¸à¸£à¸°à¸šà¸šà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?',()=>{ locked=true; updateLockUI(); toast('à¸¥à¹‡à¸­à¸à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§','ok'); });
};
function openLock(){
  const i=document.getElementById('pwInp');
  i.value=''; i.style.borderColor=''; i.placeholder='â€¢â€¢â€¢â€¢â€¢â€¢';
  document.getElementById('lockOverlay').classList.add('show');
  setTimeout(()=>i.focus(),80);
}
window.closeLock=()=>document.getElementById('lockOverlay').classList.remove('show');
window.checkPw=()=>{
  const i=document.getElementById('pwInp');
  if(i.value===PW){
    locked=false; updateLockUI(); closeLock(); toast('à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ ğŸ”“','ok');
  } else {
    i.style.borderColor='var(--red)';
    i.value=''; i.placeholder='à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ âŒ';
    setTimeout(()=>{ i.style.borderColor=''; i.placeholder='â€¢â€¢â€¢â€¢â€¢â€¢'; },1500);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIRM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function confirm2(ico,msg,cb){
  document.getElementById('cfmIco').textContent=ico;
  document.getElementById('cfmMsg').textContent=msg;
  cfmCb=cb;
  document.getElementById('cfmOverlay').classList.add('show');
}
window.closeCfm=yes=>{
  document.getElementById('cfmOverlay').classList.remove('show');
  if(yes&&typeof cfmCb==='function') cfmCb();
  cfmCb=null;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id){ document.getElementById(id).classList.add('show'); }
window.closeModal=id=>document.getElementById(id).classList.remove('show');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.setRole=r=>{
  role=r;
  document.querySelectorAll('.role-btn').forEach(b=>b.classList.toggle('on',b.dataset.r===r));
  renderGrid();
};

function renderGrid(){
  const grid=document.getElementById('heroGrid');
  const none=document.getElementById('noHero');
  let list=LIB.filter(h=>CTRS.some(c=>c.heroId===h.id));
  if(role!=='all') list=list.filter(h=>h.role===role);
  if(!list.length){ grid.style.display='none'; none.style.display='block'; return; }
  grid.style.display='grid'; none.style.display='none';
  grid.innerHTML='';
  list.forEach((h,i)=>{
    const cd=CTRS.find(c=>c.heroId===h.id);
    const cnt=cd&&cd.counters?cd.counters.length:0;
    const el=document.createElement('div');
    el.className='hero-card';
    el.style.animationDelay=`${i*0.04}s`;
    el.innerHTML=`
      ${h.image
        ? `<div class="hero-card-img"><img src="${h.image}" alt="${esc(h.name)}" loading="lazy"></div>`
        : `<div class="hero-card-placeholder">â“</div>`}
      ${h.role?`<div class="hero-card-role">${esc(h.role)}</div>`:''}
      ${cnt>0?`<div class="hero-card-badge">${cnt} CTR</div>`:''}
      <div class="hero-card-name">${esc(h.name)}</div>`;
    el.onclick=()=>openDetail(h.id);
    grid.appendChild(el);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDetail(id){
  viewId=id;
  const h=LIB.find(x=>x.id===id); if(!h) return;
  const cd=CTRS.find(c=>c.heroId===id);

  document.getElementById('dtTitle').textContent=h.name;
  document.getElementById('dtName').textContent=h.name;
  document.getElementById('dtImg').innerHTML=h.image
    ?`<img src="${h.image}" alt="${esc(h.name)}">`
    :`<div style="width:100%;height:100%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:3.5rem">â“</div>`;

  const tags=document.getElementById('dtTags'); tags.innerHTML='';
  if(h.role) tags.innerHTML+=`<div class="tag">ğŸ“ ${esc(h.role)}</div>`;
  if(h.lane) tags.innerHTML+=`<div class="tag">ğŸ›£ï¸ ${esc(h.lane)}</div>`;

  const cs=document.getElementById('dtCounterSec');
  if(cd&&cd.counters&&cd.counters.length){
    cs.style.display='block';
    document.getElementById('dtCounterGrid').innerHTML=cd.counters.map(cid=>{
      const ch=LIB.find(x=>x.id===cid); if(!ch) return '';
      return `<div class="c-card"><div class="c-card-img">${ch.image?`<img src="${ch.image}" alt="${esc(ch.name)}">`:`<div style="height:100%;display:flex;align-items:center;justify-content:center;font-size:2rem">â“</div>`}</div><div class="c-card-name">${esc(ch.name)}</div></div>`;
    }).join('');
  } else { cs.style.display='none'; }

  const ns=document.getElementById('dtNotesSec');
  if(cd&&cd.notes&&cd.notes.trim()){ ns.style.display='block'; document.getElementById('dtNotesBox').textContent=cd.notes; }
  else { ns.style.display='none'; }

  openModal('detailModal');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDIT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.openEditModal=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  if(!viewId) return;
  editId=viewId;
  const h=LIB.find(x=>x.id===editId);
  const cd=CTRS.find(c=>c.heroId===editId);

  picked=cd&&cd.counters?[...cd.counters]:[];
  document.getElementById('editNotes').value=cd&&cd.notes?cd.notes:'';

  const th=document.getElementById('editThumb');
  th.innerHTML=h&&h.image
    ?`<img src="${h.image}" alt="">`
    :`<div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.1rem">âš”ï¸</div>`;
  document.getElementById('editTitle').textContent=h?`à¹à¸à¹‰à¹„à¸‚: ${h.name}`:'à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ';
  document.getElementById('pickerSearch').value='';

  renderPicker();
  renderPickedList();
  closeModal('detailModal');
  openModal('editModal');
};

/* â”€â”€ renderPicker: à¸ªà¸£à¹‰à¸²à¸‡ DOM à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹„à¸¡à¹ˆà¸¡à¸µ double-click bug â”€â”€ */
function renderPicker(){
  const term=document.getElementById('pickerSearch').value.trim().toLowerCase();
  const grid=document.getElementById('pickerGrid');
  const list=LIB.filter(h=>h.id!==editId&&(!term||h.name.toLowerCase().includes(term)));

  if(!list.length){
    grid.innerHTML=`<div class="picker-empty">à¹„à¸¡à¹ˆà¸à¸šà¸®à¸µà¹‚à¸£à¹ˆà¸—à¸µà¹ˆà¸„à¹‰à¸™à¸«à¸²</div>`;
    return;
  }

  grid.innerHTML='';
  list.forEach(h=>{
    const isPicked=picked.includes(h.id);
    const el=document.createElement('div');
    el.className='picker-item'+(isPicked?' picked':'');
    el.dataset.hid=h.id;
    el.title=h.name;
    el.innerHTML=`
      <div class="picker-item-img">
        ${h.image
          ?`<img src="${h.image}" alt="${esc(h.name)}" loading="lazy">`
          :`<div class="picker-item-ph">â“</div>`}
      </div>
      <div class="picker-item-name">${esc(h.name)}</div>
      <div class="picker-ck">âœ“</div>`;

    /* â”€â”€ FIX double-click: à¹ƒà¸Šà¹‰ mousedown à¹à¸—à¸™ click à¹€à¸à¸·à¹ˆà¸­ immediate response â”€â”€ */
    el.addEventListener('mousedown', e=>{
      e.preventDefault(); // à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ focus à¸—à¸³à¹ƒà¸«à¹‰ input blur à¹à¸¥à¹‰à¸§ re-render
      const idx=picked.indexOf(h.id);
      if(idx>-1){
        picked.splice(idx,1);
        el.classList.remove('picked');
      } else {
        picked.push(h.id);
        el.classList.add('picked');
      }
      renderPickedList();
    });
    /* mobile: touchend */
    el.addEventListener('touchend', e=>{
      e.preventDefault();
      const idx=picked.indexOf(h.id);
      if(idx>-1){ picked.splice(idx,1); el.classList.remove('picked'); }
      else { picked.push(h.id); el.classList.add('picked'); }
      renderPickedList();
    });

    grid.appendChild(el);
  });
}

function renderPickedList(){
  const wrap=document.getElementById('pickedList');
  if(!picked.length){
    wrap.innerHTML='<span class="picked-empty">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œ</span>';
    return;
  }
  wrap.innerHTML=picked.map(hid=>{
    const h=LIB.find(x=>x.id===hid); if(!h) return '';
    return `<span class="picked-tag" data-ptid="${hid}">
      ${h.image?`<img src="${h.image}" alt="${esc(h.name)}">`:''}
      ${esc(h.name)}
      <button class="picked-tag-rm" data-rm="${hid}">Ã—</button>
    </span>`;
  }).join('');

  wrap.querySelectorAll('[data-rm]').forEach(btn=>{
    btn.addEventListener('mousedown', e=>{
      e.stopPropagation();
      const hid=btn.dataset.rm;
      picked=picked.filter(x=>x!==hid);
      const pi=document.querySelector(`.picker-item[data-hid="${hid}"]`);
      if(pi) pi.classList.remove('picked');
      renderPickedList();
    });
  });
}

window.saveEdit=async()=>{
  if(!editId){ toast('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”','err'); return; }
  const ctr={heroId:editId,counters:[...picked],notes:document.getElementById('editNotes').value.trim()};
  try{
    await saveCtr(ctr);
    closeModal('editModal');
    toast('à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ âœ…','ok');
    viewId=editId;
    openDetail(editId);
  }catch(e){ toast('à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ: '+e.message,'err'); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DELETE COUNTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.doDeleteCounter=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  const h=LIB.find(x=>x.id===viewId);
  confirm2('ğŸ—‘ï¸',`à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸„à¸²à¸™à¹Œà¹€à¸•à¸­à¸£à¹Œà¸‚à¸­à¸‡ "${h?h.name:'à¸®à¸µà¹‚à¸£à¹ˆà¸™à¸µà¹‰'}"?`,async()=>{
    try{ await deleteCtr(viewId); closeModal('detailModal'); viewId=null; toast('à¸¥à¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','ok'); }
    catch(e){ toast('à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
  });
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIBRARY MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.openAddHero=()=>{
  if(locked){ toast('à¸à¸£à¸¸à¸“à¸²à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸à¹ˆà¸­à¸™','err'); return; }
  libSel=[];
  document.getElementById('libSearch').value='';
  renderLibGrid();
  switchLibTab('sel');
  openModal('libModal');
};

window.switchLibTab=t=>{
  document.getElementById('libTabSel').classList.toggle('on',t==='sel');
  document.getElementById('libTabAdd').classList.toggle('on',t==='add');
  document.getElementById('libSelPane').style.display=t==='sel'?'block':'none';
  document.getElementById('libAddPane').style.display=t==='add'?'block':'none';
};

/* â”€â”€ renderLibGrid: à¹ƒà¸Šà¹‰ mousedown à¹€à¸à¸·à¹ˆà¸­ fix double-click bug â”€â”€ */
function renderLibGrid(){
  const term=document.getElementById('libSearch').value.trim().toLowerCase();
  const grid=document.getElementById('libGrid');
  const list=LIB.filter(h=>!term||h.name.toLowerCase().includes(term));
  grid.innerHTML='';

  if(!list.length){
    grid.innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--txt3);font-size:.88rem">à¹„à¸¡à¹ˆà¸à¸šà¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸™à¸„à¸¥à¸±à¸‡<br>à¸à¸” "à¹€à¸à¸´à¹ˆà¸¡à¸®à¸µà¹‚à¸£à¹ˆà¹ƒà¸«à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡" à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¸´à¹ˆà¸¡</div>`;
    document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`;
    return;
  }

  list.forEach(h=>{
    const isSel=libSel.includes(h.id);
    const el=document.createElement('div');
    el.className='lib-item'+(isSel?' lib-selected':'');
    el.dataset.hid=h.id;
    el.innerHTML=`
      <div class="lib-item-inner">
        ${h.image
          ?`<img src="${h.image}" alt="${esc(h.name)}" loading="lazy">`
          :`<div class="lib-item-ph">â“</div>`}
      </div>
      <div class="lib-item-name">${esc(h.name)}</div>
      <div class="lib-ck">âœ“</div>
      ${!locked?`<button class="lib-item-del">Ã—</button>`:''}`;

    /* â”€â”€ FIX: mousedown immediate response, à¹„à¸¡à¹ˆà¸£à¸­ click â”€â”€ */
    el.addEventListener('mousedown', e=>{
      if(e.target.classList.contains('lib-item-del')) return; // à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰à¸›à¸¸à¹ˆà¸¡à¸¥à¸šà¸ˆà¸±à¸”à¸à¸²à¸£
      e.preventDefault();
      const idx=libSel.indexOf(h.id);
      if(idx>-1){ libSel.splice(idx,1); el.classList.remove('lib-selected'); }
      else       { libSel.push(h.id);   el.classList.add('lib-selected'); }
      document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`;
    });
    el.addEventListener('touchend', e=>{
      if(e.target.classList.contains('lib-item-del')) return;
      e.preventDefault();
      const idx=libSel.indexOf(h.id);
      if(idx>-1){ libSel.splice(idx,1); el.classList.remove('lib-selected'); }
      else       { libSel.push(h.id);   el.classList.add('lib-selected'); }
      document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`;
    });

    /* delete button */
    const delBtn=el.querySelector('.lib-item-del');
    if(delBtn){
      delBtn.addEventListener('mousedown', e=>{ e.stopPropagation(); e.preventDefault(); });
      delBtn.addEventListener('click', e=>{ e.stopPropagation(); doDelFromLib(h.id); });
    }

    grid.appendChild(el);
  });
  document.getElementById('libSelCount').textContent=`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ ${libSel.length} à¸®à¸µà¹‚à¸£à¹ˆ`;
}

window.confirmLibSel=async()=>{
  if(!libSel.length){ toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸®à¸µà¹‚à¸£à¹ˆà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸•à¸±à¸§','err'); return; }
  let added=0;
  for(const hid of libSel){
    if(!CTRS.find(c=>c.heroId===hid)){
      await saveCtr({heroId:hid,counters:[],notes:''});
      added++;
    }
  }
  closeModal('libModal');
  renderGrid();

  if(libSel.length===1){
    viewId=libSel[0]; editId=libSel[0];
    const h=LIB.find(x=>x.id===editId);
    const cd=CTRS.find(c=>c.heroId===editId);
    picked=cd&&cd.counters?[...cd.counters]:[];
    document.getElementById('editNotes').value=cd&&cd.notes?cd.notes:'';
    const th=document.getElementById('editThumb');
    th.innerHTML=h&&h.image
      ?`<img src="${h.image}" alt="">`
      :`<div style="background:var(--bg3);width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.1rem">âš”ï¸</div>`;
    document.getElementById('editTitle').textContent=h?`à¹à¸à¹‰à¹„à¸‚: ${h.name}`:'à¹à¸à¹‰à¹„à¸‚à¸®à¸µà¹‚à¸£à¹ˆ';
    document.getElementById('pickerSearch').value='';
    renderPicker(); renderPickedList();
    openModal('editModal');
  }
  toast(added?`à¹€à¸à¸´à¹ˆà¸¡ ${added} à¸®à¸µà¹‚à¸£à¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§`:'à¸®à¸µà¹‚à¸£à¹ˆà¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸¡à¸µà¹ƒà¸™à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§','ok');
};

function doDelFromLib(hid){
  if(locked) return;
  const h=LIB.find(x=>x.id===hid);
  confirm2('ğŸ—‘ï¸',`à¸¥à¸š "${h?h.name:'à¸®à¸µà¹‚à¸£à¹ˆà¸™à¸µà¹‰'}" à¸­à¸­à¸à¸ˆà¸²à¸à¸„à¸¥à¸±à¸‡?`,async()=>{
    try{
      await deleteLibHero(hid);
      libSel=libSel.filter(x=>x!==hid);
      picked=picked.filter(x=>x!==hid);
      if(!useFirebase){ renderLibGrid(); renderGrid(); }
      if(document.getElementById('editModal').classList.contains('show')){ renderPicker(); renderPickedList(); }
      toast('à¸¥à¸šà¸®à¸µà¹‚à¸£à¹ˆà¸­à¸­à¸à¸ˆà¸²à¸à¸„à¸¥à¸±à¸‡à¹à¸¥à¹‰à¸§','ok');
    }catch(e){ toast('à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
  });
}

window.addHeroToLib=async()=>{
  const name=document.getElementById('qName').value.trim();
  if(!name){ toast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸®à¸µà¹‚à¸£à¹ˆ','err'); return; }
  if(LIB.some(h=>h.name.toLowerCase()===name.toLowerCase())){ toast('à¸®à¸µà¹‚à¸£à¹ˆà¸Šà¸·à¹ˆà¸­à¸™à¸µà¹‰à¸¡à¸µà¹ƒà¸™à¸„à¸¥à¸±à¸‡à¹à¸¥à¹‰à¸§','err'); return; }
  const url=document.getElementById('qUrl').value.trim();
  const hero={ id:Date.now().toString(), name, image:pendImg||url||'', role:document.getElementById('qRole').value, lane:'' };
  try{
    await saveLib(hero);
    document.getElementById('qName').value='';
    document.getElementById('qRole').value='';
    document.getElementById('qUrl').value='';
    document.getElementById('qFile').value='';
    pendImg='';
    const z=document.getElementById('qUpload');
    z.classList.remove('has-img'); z.innerHTML='<span>ğŸ“ à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸ à¸²à¸</span>';
    if(!useFirebase) renderLibGrid();
    if(document.getElementById('editModal').classList.contains('show')) renderPicker();
    toast(`à¹€à¸à¸´à¹ˆà¸¡ "${name}" à¹€à¸‚à¹‰à¸²à¸„à¸¥à¸±à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ`,'ok');
  }catch(e){ toast('à¹€à¸à¸´à¹ˆà¸¡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ','err'); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(msg,type='ok'){
  document.querySelectorAll('.toast').forEach(t=>t.remove());
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  const ico=type==='ok'?'âœ…':type==='info'?'â„¹ï¸':'âŒ';
  t.innerHTML=`<span>${ico}</span><span>${esc(msg)}</span>`;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3200);
}

function esc(s){
  return String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

init();
</script>

</body>
</html>